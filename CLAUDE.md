# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

This is a Hugo-powered educational book titled "íŒŒì´ì¬ìœ¼ë¡œ ë°°ìš°ëŠ” ë°±í…ŒìŠ¤íŒ… ì…ë¬¸" (Introduction to Backtesting with Python). The book teaches quantitative trading fundamentals through hands-on backtesting exercises using Python. It contains both the Hugo documentation site and executable Python code examples that readers run alongside reading the chapters.

**Key characteristics:**
- **Primary language: Korean (í•œêµ­ì–´)** - All book content, explanations, and user-facing text are written in Korean
- Dual structure: Hugo book content in `content/docs/` + executable Python examples in `codes/`
- English technical terms preserved where appropriate (e.g., "backtesting", "OHLCV", "Sharpe Ratio")
- Educational focus with mathematical explanations (LaTeX math rendering enabled)
- uv package manager for Python environment management

## Commands

### Hugo (Book Site)

```bash
# Start development server
hugo server

# Build static site
hugo

# Output will be in /public/

# Create new content (use this to generate properly structured markdown files)
hugo new content/docs/chapterXX.md

# Check configuration and syntax
hugo config

# Validate content without building
hugo --renderToMemory
```

**AI Usage Note**: When creating new chapters, leverage the `hugo new` command to generate content files with proper frontmatter. Use `hugo server` to preview changes and `hugo config` to verify configuration syntax.

### Python Code Examples

All Python code examples use `uv` as the package manager:

```bash
# Initial setup (from codes/ directory)
cd codes
uv sync

# Run chapter examples
uv run chapter01/01_basic_data_download.py
uv run chapter01/02_matplotlib_basics.py
uv run chapter01/03_first_backtest.py

# Run examples from any chapter
uv run chapter02/01_data_download_multiple_timeframes.py
uv run chapter03/01_sma_calculation.py
```

**Important**: All Python code must be run with `uv run` prefix from the `codes/` directory. The environment is already initialized with uv.

## Architecture

### Repository Structure

```
â”œâ”€â”€ content/docs/          # Hugo book chapters (markdown)
â”‚   â”œâ”€â”€ chapter01.md       # Chapter content with theory + explanations
â”‚   â”œâ”€â”€ chapter02.md
â”‚   â””â”€â”€ chapter03.md
â”œâ”€â”€ static/images/         # PERMANENT: Hugo-served images
â”‚   â”œâ”€â”€ chapter01/         # Static images for Chapter 1
â”‚   â”œâ”€â”€ chapter02/         # Static images for Chapter 2
â”‚   â””â”€â”€ chapterXX/         # Create for each chapter
â”œâ”€â”€ codes/                 # Executable Python examples
â”‚   â”œâ”€â”€ chapter01/         # Chapter-specific code files
â”‚   â”‚   â””â”€â”€ images/        # GENERATED: Code output images
â”‚   â”œâ”€â”€ chapter02/
â”‚   â”‚   â””â”€â”€ images/
â”‚   â”œâ”€â”€ data/              # Downloaded stock data (CSV files)
â”‚   â”œâ”€â”€ pyproject.toml     # Python dependencies managed by uv
â”‚   â””â”€â”€ README.md          # Korean instructions for running code
â”œâ”€â”€ references/            # Library documentation references
â”‚   â”œâ”€â”€ backtrader.md      # Backtrader framework guide
â”‚   â””â”€â”€ yfinance.md        # yfinance API reference
â”œâ”€â”€ hugo.toml              # Hugo configuration
â”œâ”€â”€ CLAUDE.md              # This file (AI instructions)
â”œâ”€â”€ TABLE_OF_CONTENTS.md   # Complete book structure
â””â”€â”€ themes/hugo-book/      # Hugo Book theme (submodule)
```

**Key Directories**:
- `content/docs/`: Markdown chapters (Korean text, references `/images/`)
- `static/images/`: Permanent images served by Hugo
- `codes/chapterXX/images/`: Temporary images generated by code
- `codes/data/`: Downloaded financial data (gitignored)

### Content-Code Relationship

Each chapter follows a consistent pattern:
1. **Theory in markdown** (`content/docs/chapterXX.md`): Mathematical foundations, explanations, analysis
2. **Implementation in Python** (`codes/chapterXX/`): Working code that demonstrates concepts
3. **Generated outputs**: Charts saved to `codes/chapterXX/images/`, data to `codes/data/`

Example for Chapter 1:
- `content/docs/chapter01.md` explains backtesting concepts, OHLCV data structure, moving averages
- `codes/chapter01/01_basic_data_download.py` downloads NVIDIA data, calculates statistics
- `codes/chapter01/02_matplotlib_basics.py` creates visualizations
- `codes/chapter01/03_first_backtest.py` implements Buy & Hold and SMA strategies

### Python Code Architecture

The `codes/` directory is structured as individual executable scripts per chapter rather than a unified package. Each script:
- Is self-contained and executable with `uv run`
- Uses relative paths based on `__file__` for data directories
- Generates outputs (CSV data, PNG charts) in predictable locations
- Follows consistent naming: `0X_descriptive_name.py`

**Key dependencies** (from `pyproject.toml`):
- `yfinance`: Download stock data from Yahoo Finance
- `pandas`: Data manipulation and analysis
- `matplotlib`: Chart generation and visualization
- `backtrader`: Backtesting framework for trading strategies
- `numpy`: Numerical computations
- `seaborn`: Statistical visualizations

### Hugo Configuration

From `hugo.toml`:
- Theme: `hugo-book` (documentation-focused theme)
- Math rendering enabled via Goldmark extensions (LaTeX support with `$...$` and `$$...$$`)
- Korean language site with English technical terms
- Git info enabled for "last modified" dates
- Table of contents enabled on right side

## Working with This Repository

**Using Hugo CLI**: AI assistants should leverage the `hugo` CLI tool for:
- Creating new content with proper structure (`hugo new`)
- Validating syntax and configuration (`hugo config`, `hugo --renderToMemory`)
- Previewing changes in real-time (`hugo server`)
- Building the final site (`hugo`)

## Chapter Development Workflow

**Follow this workflow when creating or enhancing chapters:**

### Step 1: Plan Content
1. Review `TABLE_OF_CONTENTS.md` for chapter objectives
2. Identify key concepts to teach
3. Determine required code examples
4. Plan visualizations needed

### Step 2: Write Theory (Markdown)
1. Create or edit `content/docs/chapterXX.md`
2. Write Korean explanations with LaTeX formulas
3. Structure: Introduction â†’ Concepts â†’ Mathematics â†’ Applications
4. Leave placeholders for execution results and charts

### Step 3: Write Code (Python)
1. Create scripts in `codes/chapterXX/`
2. **MANDATORY**: Add Korean font configuration to all matplotlib code
   ```python
   plt.rcParams['font.family'] = ['Nanum Gothic', 'Malgun Gothic', 'AppleGothic',
                                   'Arial Unicode MS', 'DejaVu Sans']
   plt.rcParams['axes.unicode_minus'] = False
   ```
3. Save charts to `codes/chapterXX/images/`
4. Print clear Korean output to terminal
5. Test execution: `uv run chapterXX/script.py`

### Step 4: Execute and Capture Results
1. Run all chapter scripts from `codes/` directory
2. Capture terminal output (copy actual text)
3. Verify charts are generated in `codes/chapterXX/images/`
4. Check for font warnings: `uv run chapterXX/script.py 2>&1 | grep -i font`

### Step 5: Copy Images to Static
```bash
# Create static directory if needed
mkdir -p static/images/chapterXX

# Copy generated images
cp codes/chapterXX/images/*.png static/images/chapterXX/

# Verify
ls -lh static/images/chapterXX/
```

### Step 6: Enhance Markdown with Results
1. Add execution results in code blocks (actual output, not summarized)
2. Insert images using `/images/chapterXX/filename.png` paths
3. Write detailed Korean interpretations for each chart
4. Add "í•µì‹¬ ì¸ì‚¬ì´íŠ¸" (Key Insights) section
5. Explain practical implications

### Step 7: Quality Check
Run through checklist:
- [ ] Korean fonts configured in all scripts
- [ ] All scripts execute without errors
- [ ] Images copied to `static/images/chapterXX/`
- [ ] Image paths use `/images/` format
- [ ] Execution results embedded in markdown
- [ ] Chart interpretations written in Korean
- [ ] Key insights summarized
- [ ] No font rendering warnings
- [ ] Math formulas render correctly

### Step 8: Preview and Validate
```bash
# Preview in Hugo
hugo server

# Check for broken images or formatting issues
# Navigate to http://localhost:1313/docs/chapterXX

# Validate markdown
hugo --renderToMemory
```

### Adding New Chapters

When creating a new chapter:

1. **Create markdown file using Hugo CLI** (recommended):
   ```bash
   hugo new content/docs/chapterXX.md
   ```
   - Alternatively, create manually: `content/docs/chapterXX.md`
   - Include frontmatter with `title`, `weight`, and `bookToc: true`
   - Write theory with LaTeX math formulas (in Korean, primary language)
   - Reference code files that will be created
   - Include analysis and interpretation of results
   - Use `hugo server` to preview changes in real-time

2. **Create code directory**: `codes/chapterXX/`
   - Create numbered scripts: `01_descriptive_name.py`, `02_next_concept.py`
   - Use relative paths: `os.path.join(os.path.dirname(__file__), "..", "data")`
   - Generate visualizations to `chapterXX/images/` subdirectory
   - Follow existing code patterns from previous chapters

3. **Validate and test**:
   ```bash
   hugo --renderToMemory  # Check for syntax errors
   hugo server            # Preview the site
   ```

4. **Update `codes/README.md`**: Add execution instructions for new chapter (in Korean)

### Code Execution Flow

Typical workflow for code examples:
1. Download data using `yfinance` â†’ Save to `codes/data/`
2. Process data with `pandas` â†’ Calculate indicators, statistics
3. Visualize with `matplotlib` â†’ Save charts to `chapterXX/images/`
4. Run backtests with `backtrader` â†’ Print performance metrics
5. Output is displayed in terminal and saved as files (no GUI)

### Data Management

- Stock data is downloaded to `codes/data/` in CSV format
- Data files are gitignored (users download fresh data when running scripts)
- Scripts check for existing data and reuse when appropriate
- All data paths use relative paths based on script location

### Mathematical Content

The book includes rigorous mathematical explanations:
- Returns: $R_t = \frac{P_t - P_{t-1}}{P_{t-1}}$
- Performance metrics: Sharpe Ratio, Maximum Drawdown, Annualized Return
- Technical indicators: Moving averages, RSI, MACD, Bollinger Bands
- Use LaTeX syntax in markdown with `$` (inline) or `$$` (block)

### Style Considerations

**For markdown chapters (PRIMARY LANGUAGE: KOREAN):**
- **Write ALL explanatory text in Korean (í•œêµ­ì–´)** - this is the primary language of the book
- Preserve English for technical terms when appropriate (backtesting, OHLCV, Sharpe Ratio, etc.)
- Include practical examples and real data analysis
- Balance theory (mathematical formulas) with practice (code execution)
- Mathematical notation uses standard English symbols (e.g., $R_t$, not localized)

**For Python code:**
- Self-documenting code with clear variable names (English)
- Docstrings in English for functions (standard practice)
- **Print statements and user-facing output in Korean** (matches book language)
- Comments can be in English or Korean, prefer Korean when explaining concepts
- Handle errors gracefully (internet connection, missing data)
- Use type hints where helpful
- Follow patterns from existing chapter code

### References Directory

`references/` contains comprehensive guides for key libraries:
- `backtrader.md`: Full backtrader framework documentation
- `yfinance.md`: Yahoo Finance API usage guide

Consult these when implementing strategies or downloading data.

## Image Management (CRITICAL)

**Dual Image Storage**: This project maintains images in two locations for different purposes.

### Static Images (Permanent, Hugo-Served)

**Location**: `./static/images/chapterXX/`
**Purpose**: Images displayed in the Hugo website
**Markdown Reference**: `/images/chapterXX/filename.png`

```markdown
![Chart Description](/images/chapter01/hello_trading.png)
```

**Rules**:
- âœ… **ALWAYS use `/images/` paths in markdown files** (NOT `../../codes/` paths)
- âœ… Copy representative images from `codes/chapterXX/images/` to `static/images/chapterXX/`
- âœ… These images persist and are version-controlled
- âœ… Hugo serves them from `/images/` URL path
- âœ… Update static images when code execution produces new/improved versions

### Dynamic Images (Code-Generated)

**Location**: `codes/chapterXX/images/`
**Purpose**: Generated when users run Python scripts
**Access**: Local filesystem only

**Rules**:
- Scripts save output to `chapterXX/images/` subdirectory
- Users generate their own images by running code
- Not required for Hugo site to build
- May differ based on data download timing

### Image Workflow

When adding or updating chapters:

1. **Write Python code** that saves charts to `codes/chapterXX/images/`
2. **Execute the script** to generate images: `uv run chapterXX/script.py`
3. **Copy key images** to static directory:
   ```bash
   cp codes/chapter01/images/*.png static/images/chapter01/
   ```
4. **Reference in markdown** using `/images/` path:
   ```markdown
   ![Analysis Chart](/images/chapter01/analysis.png)
   ```
5. **Commit both** code-generated and static images

### Why Two Locations?

- **Static images**: Guarantee Hugo site displays charts even if users haven't run code
- **Code-generated images**: Demonstrate reproducibility and allow users to generate fresh data
- **Best of both worlds**: Website works immediately + users can verify by running code

## Korean Font Configuration (MANDATORY)

**Problem**: matplotlib defaults to fonts that don't support Korean characters (í•œê¸€), causing text to display as boxes (â–¡â–¡â–¡).

**Solution**: Configure Korean fonts in ALL Python scripts that use matplotlib.

### Standard Font Configuration

Add this code block immediately after importing matplotlib in EVERY script:

```python
import matplotlib
matplotlib.use('Agg')  # For non-GUI environments
import matplotlib.pyplot as plt

# MANDATORY: Korean font configuration
plt.rcParams['font.family'] = ['Nanum Gothic', 'Malgun Gothic', 'AppleGothic',
                                'Arial Unicode MS', 'DejaVu Sans']
plt.rcParams['axes.unicode_minus'] = False  # Fix minus sign rendering
```

### Font Priority Chain

1. **Nanum Gothic** - Primary choice (good availability, clean rendering)
2. **Malgun Gothic** - Windows default Korean font
3. **AppleGothic** - macOS system font
4. **Arial Unicode MS** - Cross-platform Unicode font
5. **DejaVu Sans** - Final fallback (English-only)

**Rationale**: The font list provides fallbacks across different operating systems. matplotlib will try each font in order until it finds one installed on the user's system.

### Where to Add Font Configuration

- âœ… Every script that imports `matplotlib.pyplot`
- âœ… Add immediately after imports, before any plotting code
- âœ… Include even if existing code has partial font settings
- âœ… Both new scripts and when editing existing scripts

### Testing Font Configuration

After adding font configuration:
```bash
# Run script and check for warnings
uv run chapterXX/script.py 2>&1 | grep -i font

# No "missing glyph" or "font not found" warnings = success
```

### Common Mistakes to Avoid

âŒ **Wrong**: `plt.rcParams['font.family'] = 'DejaVu Sans'` (Korean won't render)
âŒ **Wrong**: No font configuration (relies on system defaults)
âŒ **Wrong**: Only setting font in one script per chapter
âœ… **Correct**: Font configuration in EVERY matplotlib script
âœ… **Correct**: Using the standard font priority chain above

## Chapter Enhancement Standards

**All chapters must include**: Theory + Code + Execution Results + Interpretation

### Required Elements for Each Chapter

1. **Theory Section** (Korean)
   - Concept explanations
   - Mathematical formulas (LaTeX)
   - Why this concept matters

2. **Code Examples**
   - Executable Python scripts in `codes/chapterXX/`
   - Korean font configuration in matplotlib
   - Clear output to terminal

3. **Execution Results** (Korean)
   - Actual output from running scripts
   - Wrapped in markdown code blocks:
     ```
     ==========================================
     Chapter X: Title
     ==========================================
     [actual output here]
     ```

4. **Chart Interpretations** (Korean)
   - Detailed analysis of EACH chart/subplot
   - Explain what patterns/trends are visible
   - Connect visualizations to theory
   - Provide actionable insights

5. **Key Insights** (Korean)
   - Bullet-point summary of main findings
   - Practical implications
   - Common pitfalls to avoid
   - Real-world applications

### Visualization Guidelines

**Every chart must include**:
- Clear title (Korean)
- Axis labels (Korean with English units)
- Legend when multiple series
- Consistent color scheme

**Chart interpretation must explain**:
- What the chart shows (data description)
- Notable patterns or trends
- Outliers or anomalies
- Practical meaning/implications
- Connection to trading strategy

### Example Format

```markdown
### ì‹¤í–‰ ê²°ê³¼

ì‹¤ì œë¡œ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰í•œ ê²°ê³¼ì…ë‹ˆë‹¤:

\`\`\`
==========================================
Chapter X: Title
==========================================
[paste actual terminal output]
\`\`\`

![Chart Title](/images/chapterXX/filename.png)

**ì°¨íŠ¸ í•´ì„**:
- **ìƒë‹¨ íŒ¨ë„**: [Describe what's shown and what it means]
- **í•˜ë‹¨ íŒ¨ë„**: [Describe what's shown and what it means]

**í•µì‹¬ ì¸ì‚¬ì´íŠ¸**:
- [Key finding 1]
- [Key finding 2]
- [Practical implication]
```

### Quality Checklist

Before marking a chapter as complete, verify:

- [ ] All code scripts have Korean font configuration
- [ ] All scripts execute successfully (`uv run chapterXX/script.py`)
- [ ] Execution results are included in markdown
- [ ] All generated images are copied to `static/images/chapterXX/`
- [ ] All markdown image references use `/images/` paths
- [ ] Each chart has a detailed Korean interpretation
- [ ] Key insights section summarizes main findings
- [ ] LaTeX math formulas render correctly
- [ ] All Korean text displays properly (no â–¡â–¡â–¡)
- [ ] Practical applications or trading implications are discussed

## Content Completeness Levels

### Level 1: Basic (Minimum Viable)
- Theory written in Korean
- Code examples exist
- Scripts are executable

### Level 2: Enhanced (Target Standard)
- âœ… All Level 1 requirements
- âœ… Execution results included in markdown
- âœ… Charts with interpretations
- âœ… Key insights summarized
- âœ… Korean fonts configured properly

### Level 3: Comprehensive (Premium)
- âœ… All Level 2 requirements
- âœ… Multiple examples with varying parameters
- âœ… Comparison with benchmarks
- âœ… Common mistakes highlighted
- âœ… Advanced tips and tricks
- âœ… Real-world case studies

**Target**: All Part 1-4 chapters at Level 2 minimum, Part 5-6 at Level 3.

## Common Pitfalls and Solutions

### âŒ Pitfall 1: Image Path Issues
**Problem**: Markdown references `../../codes/chapterXX/images/file.png`
**Why it fails**: Hugo doesn't have access to `codes/` directory
**Solution**: Always use `/images/chapterXX/file.png` and copy images to `static/images/`

### âŒ Pitfall 2: Missing Font Configuration
**Problem**: Korean text displays as â–¡â–¡â–¡ in charts
**Why it happens**: matplotlib defaults don't include Korean fonts
**Solution**: Add font configuration to EVERY script that uses matplotlib
```python
plt.rcParams['font.family'] = ['Nanum Gothic', 'Malgun Gothic', 'AppleGothic',
                                'Arial Unicode MS', 'DejaVu Sans']
plt.rcParams['axes.unicode_minus'] = False
```

### âŒ Pitfall 3: Incomplete Chart Explanations
**Problem**: Chart included but no interpretation provided
**Why it's bad**: Readers don't learn what patterns mean
**Solution**: Write detailed Korean interpretation for EVERY chart:
- What the chart shows (description)
- Notable patterns or trends (observation)
- What it means (interpretation)
- Practical implications (application)

### âŒ Pitfall 4: Theory Without Execution
**Problem**: Markdown explains concept but doesn't show code results
**Why it's bad**: Readers can't verify claims, reduces trust
**Solution**: Always include actual execution output:
```markdown
### ì‹¤í–‰ ê²°ê³¼
\`\`\`
[paste ACTUAL terminal output here]
\`\`\`
```

### âŒ Pitfall 5: Not Testing After Changes
**Problem**: Update code but don't re-run to verify
**Why it's bad**: May introduce errors, outdated output in docs
**Solution**: After ANY code change:
1. Run: `uv run chapterXX/script.py`
2. Check output for errors
3. Verify images generated correctly
4. Update static images if changed
5. Update execution results in markdown

### âŒ Pitfall 6: Inconsistent Image Quality
**Problem**: Some images are low resolution or have different styles
**Why it's bad**: Unprofessional appearance
**Solution**: Use consistent settings:
```python
plt.savefig('filename.png', dpi=300, bbox_inches='tight')
```

### âŒ Pitfall 7: Forgetting to Copy Images
**Problem**: Update code, regenerate images, but forget to copy to static
**Why it's bad**: Hugo site shows old images
**Solution**: Always copy after regenerating:
```bash
cp codes/chapterXX/images/*.png static/images/chapterXX/
```

### âŒ Pitfall 8: No Key Insights Summary
**Problem**: Lots of data and charts but no takeaways
**Why it's bad**: Readers don't know what to remember
**Solution**: Always end sections with:
```markdown
**í•µì‹¬ ì¸ì‚¬ì´íŠ¸**:
- [Main finding 1]
- [Main finding 2]
- [Practical implication]
```

### âœ… Success Pattern: Complete Enhancement Flow

1. **Code** â†’ Write with Korean font config
2. **Execute** â†’ Run and verify output
3. **Copy** â†’ Move images to static/
4. **Document** â†’ Add results + interpretations
5. **Test** â†’ Preview in Hugo
6. **Validate** â†’ Check all items in quality checklist

Following this pattern ensures every chapter meets Level 2 standards.

## Current Progress

### Completed Work

**Part 1 (Chapters 1-4): Foundations & Data** âœ… **COMPLETE - Level 2 Enhanced**

All chapters include:
- âœ… Complete Korean theory with LaTeX formulas
- âœ… Executable Python code with Korean font configuration
- âœ… Actual execution results embedded in markdown
- âœ… Detailed chart interpretations in Korean
- âœ… Key insights and practical applications
- âœ… All images in `static/images/` with `/images/` references
- âœ… High-quality visualizations (300 DPI PNG)

**Status**: Part 1 is **publication-ready**. See `PART1_ENHANCEMENT_SUMMARY.md` for details.

### Remaining Work

**Part 2 (Chapters 5-8): Technical Analysis Strategies** ğŸ”„ IN PROGRESS
- Chapter 5: ì´ë™í‰ê·  ì „ëµ (Moving Average)
- Chapter 6: ëª¨ë©˜í…€ê³¼ ë³€ë™ì„± ì§€í‘œ (Momentum & Volatility)
- Chapter 7: ì¶”ì„¸ ì¶”ì¢…ê³¼ í‰ê·  íšŒê·€ (Trend Following & Mean Reversion)
- Chapter 8: ë‹¤ì¤‘ ì§€í‘œ ê²°í•© ì „ëµ (Multi-Indicator)

**Part 3 (Chapters 9-11): Risk & Portfolio Management** ğŸ“‹ PLANNED
**Part 4 (Chapters 12-13): Performance Analysis** ğŸ“‹ PLANNED
**Part 5 (Chapters 14-16): Advanced Techniques** ğŸ“‹ PLANNED
**Part 6 (Chapters 17-18): Real-World Application** ğŸ“‹ PLANNED

### Book Structure Overview

The book follows a balanced approach covering:
- Technical Analysis Strategies (40%)
- Portfolio Management (25%)
- Machine Learning (20%)
- Foundations & Real-World Application (15%)

See `TABLE_OF_CONTENTS.md` for the complete 18-chapter plan.

**Target audience**: Readers with basic Python knowledge (variables, loops, functions)

### Quality Standards Applied

All completed chapters follow:
- Korean-first content with English technical terms
- Theory + Code + Results + Interpretation format
- Publication-quality visualizations (300 DPI)
- Cross-platform font support (Nanum Gothic priority)
- Hugo-compatible static image management
- Real execution results (not simulated)
