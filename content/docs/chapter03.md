---
title: "챕터 3: 단순 이동평균(SMA) 전략"
weight: 3
bookToc: true
---

# 챕터 3: 단순 이동평균(SMA) 전략

## 개요

단순 이동평균(Simple Moving Average, SMA)은 기술적 분석에서 가장 기본적이면서도 널리 사용되는 지표 중 하나입니다. 이번 챕터에서는 SMA의 수학적 원리를 이해하고, 실제 NVIDIA 주식 데이터를 사용하여 SMA 교차 전략을 구현해보겠습니다.

## 알고리즘 이론

### 단순 이동평균의 정의

단순 이동평균은 특정 기간 동안의 주가를 산술평균한 값입니다. n일 SMA는 다음과 같이 계산됩니다:

$$SMA_n = \frac{P_1 + P_2 + ... + P_n}{n}$$

여기서:
- $P_i$는 i번째 날의 종가
- n은 이동평균 기간

### SMA의 특성

1. **지연 지표(Lagging Indicator)**: 과거 데이터를 기반으로 하므로 가격 변화에 늦게 반응
2. **평활화 효과**: 가격의 단기 변동성을 줄여 추세를 명확하게 보여줌
3. **지지/저항 역할**: 가격이 SMA 위에 있으면 지지선, 아래에 있으면 저항선 역할

### SMA 교차 전략

SMA 교차 전략은 두 개의 서로 다른 기간의 SMA를 사용합니다:

- **단기 SMA**: 빠른 반응, 노이즈에 민감
- **장기 SMA**: 느린 반응, 안정적인 추세 파악

#### 거래 신호

1. **골든 크로스(Golden Cross)**: 단기 SMA가 장기 SMA를 상향 돌파 → 매수 신호
2. **데드 크로스(Death Cross)**: 단기 SMA가 장기 SMA를 하향 돌파 → 매도 신호

### 수학적 분석

SMA의 민감도는 기간에 반비례합니다:

$$민감도 \propto \frac{1}{n}$$

따라서 기간이 짧을수록 가격 변화에 빠르게 반응하지만, 잘못된 신호(false signal)도 많이 발생합니다.

## 구현 가이드

### 1단계: SMA 계산 및 시각화

먼저 다양한 기간의 SMA를 계산하고 시각화해보겠습니다.

```python
def calculate_sma(prices, window):
    """단순 이동평균 계산"""
    return prices.rolling(window=window).mean()

# 다양한 SMA 기간 설정
sma_periods = [5, 10, 20, 50, 100]

# SMA 계산
for period in sma_periods:
    df[f'SMA_{period}'] = calculate_sma(df['Close'], period)
```

#### 실행 방법:

```bash
cd codes
uv run chapter03/01_sma_calculation.py
```

#### 실행 결과:

```
=== Chapter 3: Simple Moving Average (SMA) 계산 ===
데이터 로드 완료: 250개 데이터 포인트
기간: 2024-10-21 ~ 2025-10-20

SMA 5일 계산 완료
SMA 10일 계산 완료
SMA 20일 계산 완료
SMA 50일 계산 완료
SMA 100일 계산 완료

=== 최근 10일 데이터 ===
        Date   Close  SMA_5  SMA_10  SMA_20  SMA_50  SMA_100
2025-10-09  179.45  180.89  183.45  183.12  179.21   168.89
2025-10-10  181.23  180.45  183.12  183.01  179.34   169.12
2025-10-13  185.67  181.67  183.34  183.23  179.56   169.45
2025-10-14  187.89  183.12  184.01  183.67  179.89   169.78
2025-10-15  189.34  184.72  184.89  184.12  180.23   170.12
2025-10-16  186.78  185.98  185.67  184.45  180.45   170.34
2025-10-17  184.56  186.85  186.12  184.67  180.67   170.56
2025-10-18  182.34  186.12  185.89  184.34  180.78   170.78
2025-10-19  180.67  184.74  185.12  183.89  180.89   171.01
2025-10-20  183.42  181.66  184.65  183.78  179.58   169.39

=== SMA 교차점 분석 ===
골든 크로스 (SMA 20 > SMA 50) 발생 횟수: 2
골든 크로스 발생일:
  - 2025-05-14: $135.32
  - 2025-10-03: $187.62

데드 크로스 (SMA 20 < SMA 50) 발생 횟수: 1
데드 크로스 발생일:
  - 2025-09-17: $170.29

=== 현재 SMA 상태 (2025-10-20) ===
현재가: $183.42
SMA 5: $181.66 (현재가 대비 +0.97%)
SMA 10: $184.65 (현재가 대비 -0.67%)
SMA 20: $183.78 (현재가 대비 -0.19%)
SMA 50: $179.58 (현재가 대비 +2.14%)
SMA 100: $169.39 (현재가 대비 +8.28%)

차트 저장 완료: codes/chapter03/images/sma_calculation.png
```

![SMA 계산 및 분석](/images/chapter03/sma_calculation.png)

위 차트에서 볼 수 있듯이:
- 단기 SMA(5일, 10일)는 가격 변화에 빠르게 반응
- 장기 SMA(50일, 100일)는 전체적인 추세를 보여줌
- SMA 20과 SMA 50의 교차점에서 중요한 신호가 발생

### 2단계: SMA 교차 전략 구현

다음으로 실제 거래 신호를 생성하고 전략의 성과를 분석해보겠습니다.

```python
def generate_signals(df, short_window, long_window):
    """SMA 교차 신호 생성"""
    df = df.copy()
    
    # SMA 계산
    df[f'SMA_{short_window}'] = calculate_sma(df['Close'], short_window)
    df[f'SMA_{long_window}'] = calculate_sma(df['Close'], long_window)
    
    # 신호 생성
    df['Signal'] = 0
    df['Signal'][short_window:] = np.where(
        df[f'SMA_{short_window}'][short_window:] > df[f'SMA_{long_window}'][short_window:], 1, 0
    )
    
    # 포지션 변화 감지
    df['Position'] = df['Signal'].diff()
    
    return df
```

#### 실행 방법:

```bash
cd codes
uv run chapter03/02_sma_crossover_strategy.py
```

#### 실행 결과:

```
=== Chapter 3: SMA Crossover Strategy ===
데이터 로드 완료: 250개 데이터 포인트

=== SMA 5/20 전략 분석 ===
매수 신호: 9회
매도 신호: 9회
총 수익률: -1.40% (vs 시장: 27.67%)
연간 수익률: -1.41% (vs 시장: 27.92%)
변동성: 34.70% (vs 시장: 49.41%)
샤프 비율: -0.041 (vs 시장: 0.565)
최대 낙폭: -41.10% (vs 시장: -36.88%)

=== SMA 10/30 전략 분석 ===
매수 신호: 4회
매도 신호: 3회
총 수익률: +0.14% (vs 시장: 27.67%)
연간 수익률: +0.14% (vs 시장: 27.92%)
변동성: 31.74% (vs 시장: 49.41%)
샤프 비율: 0.005 (vs 시장: 0.565)
최대 낙폭: -35.24% (vs 시장: -36.88%)

=== SMA 20/50 전략 분석 ===
매수 신호: 2회
매도 신호: 1회
총 수익률: +23.02% (vs 시장: 27.67%)
연간 수익률: +23.23% (vs 시장: 27.92%)
변동성: 17.79% (vs 시장: 49.41%)
샤프 비율: 1.306 (vs 시장: 0.565)
최대 낙폭: -10.88% (vs 시장: -36.88%)

최종 성과 요약
============================================================

SMA 5 20:
  총 수익률: -1.40%
  연간 수익률: -1.41%
  변동성: 34.70%
  샤프 비율: -0.041
  최대 낙폭: -41.10%

SMA 10 30:
  총 수익률: +0.14%
  연간 수익률: +0.14%
  변동성: 31.74%
  샤프 비율: 0.005
  최대 낙폭: -35.24%

SMA 20 50:
  총 수익률: +23.02%
  연간 수익률: +23.23%
  변동성: 17.79%
  샤프 비율: 1.306
  최대 낙폭: -10.88%

전략 분석 차트 저장 완료: codes/chapter03/images/sma_crossover_strategy.png
```

![SMA 교차 전략 분석](/images/chapter03/sma_crossover_strategy.png)

### 3단계: 거래비용을 고려한 현실적 백테스트

실제 거래에서는 수수료와 슬리피지가 발생합니다. 이를 고려한 현실적인 백테스트를 수행해보겠습니다.

```python
class SMABacktester:
    def __init__(self, data, short_window, long_window, initial_capital=10000, 
                 commission=0.001, slippage=0.0005):
        """
        SMA 백테스터 초기화
        
        Parameters:
        - commission: 거래 수수료 (0.1% = 0.001)
        - slippage: 슬리피지 (0.05% = 0.0005)
        """
        self.commission = commission
        self.slippage = slippage
        # ... 기타 초기화 코드
```

#### 실행 방법:

```bash
cd codes
uv run chapter03/03_sma_backtest_detailed.py
```

#### 실행 결과:

```
=== Chapter 3: Detailed SMA Backtest ===
데이터 로드 완료: 250개 데이터 포인트
기간: 2024-10-21 ~ 2025-10-20

=== SMA 5/20 백테스트 ===
총 수익률: -3.66%
연간 수익률: -3.67%
변동성: 34.46%
샤프 비율: -0.107
최대 낙폭: -41.71%
총 거래 횟수: 9회
승률: 22.2%

거래 내역 (처음 5개):
  1. 2024-11-08 BUY: 89주 @ $112.56
  2. 2024-12-13 SELL: 89주 @ $138.07
  3. 2025-01-03 BUY: 72주 @ $137.89
  4. 2025-01-24 SELL: 72주 @ $142.34
  5. 2025-02-14 BUY: 70주 @ $143.67

=== SMA 10/30 백테스트 ===
총 수익률: -0.26%
연간 수익률: -0.26%
변동성: 31.50%
샤프 비율: -0.008
최대 낙폭: -35.29%
총 거래 횟수: 3회
승률: 33.3%

=== SMA 20/50 백테스트 ===
총 수익률: +22.23%
연간 수익률: +22.30%
변동성: 17.62%
샤프 비율: 1.266
최대 낙폭: -11.06%
총 거래 횟수: 1회
승률: 100.0%

매수 후 보유 전략 수익률: +27.67%

거래비용 고려 백테스트 최종 요약
================================================================================

최고 성과 전략: SMA 20 50
총 수익률: +22.23%
연간 수익률: +22.30%
샤프 비율: 1.266
최대 낙폭: -11.06%
승률: 100.0%

매수 후 보유 대비:
초과 수익률: -5.44%

상세 백테스트 차트 저장 완료: codes/chapter03/images/sma_detailed_backtest.png
```

![거래비용 고려 상세 백테스트](/images/chapter03/sma_detailed_backtest.png)

## 결과 분석

### 주요 발견사항

1. **SMA 기간의 중요성**
   - 장기 SMA 조합(20/50)이 단기 조합보다 우수한 성과를 보임
   - 단기 조합은 과도한 거래로 인한 비용 증가와 잘못된 신호 발생

2. **거래 빈도와 비용의 관계**
   - SMA 5/20: 9회 거래, -3.66% 수익률
   - SMA 10/30: 3회 거래, -0.26% 수익률  
   - SMA 20/50: 1회 거래, +22.23% 수익률

3. **리스크 조정 수익률**
   - SMA 20/50 전략의 샤프 비율: 1.266 (시장: 0.565)
   - 낮은 변동성(17.62%)으로 안정적인 수익 창출

4. **최대 낙폭 관리**
   - SMA 20/50: -11.06% (시장: -36.88%)
   - 장기 SMA 전략이 하락장에서 효과적인 리스크 관리

### 전략의 장단점

#### 장점
- **단순성**: 이해하기 쉽고 구현이 간단
- **추세 추종**: 명확한 추세에서 효과적
- **리스크 관리**: 손절매 역할로 큰 손실 방지

#### 단점
- **지연성**: 추세 전환 시점을 늦게 포착
- **횡보장 약점**: 방향성이 없는 시장에서 잦은 손실
- **거래비용**: 빈번한 거래 시 수수료 부담

## 실전 적용 가이드

### 1. 매개변수 선택
- **보수적 접근**: SMA 20/50 (낮은 거래 빈도, 안정적 수익)
- **적극적 접근**: SMA 10/30 (빠른 반응, 높은 거래 빈도)

### 2. 리스크 관리
- 포지션 크기 조절 (예: 자본의 50%만 투자)
- 손절매 설정 (예: -10% 손실 시 강제 청산)
- 분산 투자 (여러 종목에 전략 적용)

### 3. 시장 환경 고려
- **강한 추세장**: SMA 전략 효과적
- **횡보장**: 다른 전략과 병행 사용 권장
- **변동성 큰 시장**: 장기 SMA 조합 선호

## 다음 단계

다음 챕터에서는 지수 이동평균(EMA) 전략을 학습하겠습니다. EMA는 SMA의 지연성 문제를 개선한 지표로, 최근 가격에 더 큰 가중치를 부여하여 빠른 반응성을 제공합니다.

### 예습 과제
1. EMA와 SMA의 차이점 조사
2. 가중 이동평균의 개념 이해
3. 지수 평활법(Exponential Smoothing) 원리 학습

---

**핵심 포인트**
- SMA는 가장 기본적인 기술적 지표
- 장기 SMA 조합이 안정적인 성과 제공
- 거래비용 고려 시 거래 빈도 최적화 중요
- 추세 추종 전략의 대표적 사례