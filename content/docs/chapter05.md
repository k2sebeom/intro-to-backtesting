---
title: "Chapter 5: 이동평균 전략"
weight: 5
bookToc: true
---

# Chapter 5: 이동평균 전략

이동평균(Moving Average)은 가장 기본적이면서도 널리 사용되는 기술적 지표입니다. 이번 챕터에서는 이동평균의 원리를 이해하고, 골든 크로스(Golden Cross)와 데드 크로스(Death Cross) 전략을 구현해봅니다.

## 5.1 이동평균의 종류

### 5.1.1 단순 이동평균 (Simple Moving Average, SMA)

단순 이동평균은 일정 기간 동안의 가격을 산술 평균한 값입니다:

$$
\text{SMA}_n(t) = \frac{1}{n} \sum_{i=0}^{n-1} P_{t-i}
$$

여기서:
- $n$은 기간 (예: 20일, 50일, 200일)
- $P_t$는 시점 $t$의 종가
- $t$는 현재 시점

**특징:**
- 모든 데이터에 동일한 가중치 부여
- 계산이 간단하고 해석이 쉬움
- 오래된 데이터가 갑자기 평균에서 빠지면서 "계단 효과" 발생 가능

### 5.1.2 지수 이동평균 (Exponential Moving Average, EMA)

지수 이동평균은 최근 데이터에 더 큰 가중치를 부여합니다:

$$
\text{EMA}_n(t) = \alpha \cdot P_t + (1 - \alpha) \cdot \text{EMA}_n(t-1)
$$

여기서 평활 계수(smoothing factor) $\alpha$는:

$$
\alpha = \frac{2}{n + 1}
$$

**특징:**
- 최근 데이터에 더 민감하게 반응
- 계단 효과가 없어 부드러운 곡선
- 트렌드 변화를 빠르게 포착

## 5.2 골든 크로스와 데드 크로스

### 5.2.1 골든 크로스 (Golden Cross)

**매수 신호**: 단기 이동평균이 장기 이동평균을 상향 돌파

일반적으로 사용되는 조합:
- 50일 SMA가 200일 SMA를 상향 돌파
- 50일 EMA가 200일 EMA를 상향 돌파

**의미**: 단기 추세가 장기 추세보다 강해지고 있으며, 상승 추세가 시작될 가능성

### 5.2.2 데드 크로스 (Death Cross)

**매도 신호**: 단기 이동평균이 장기 이동평균을 하향 돌파

**의미**: 단기 추세가 장기 추세보다 약해지고 있으며, 하락 추세가 시작될 가능성

### 5.2.3 전략의 장단점

**장점:**
- 명확한 진입/청산 신호
- 주요 트렌드를 따라가는 추세 추종 전략
- 구현이 간단하고 이해하기 쉬움
- 장기적으로 큰 수익 기회 포착 가능

**단점:**
- 횡보장(sideways market)에서 빈번한 거짓 신호(whipsaw)
- 신호 지연(lag): 트렌드가 이미 상당히 진행된 후 신호 발생
- 진입/청산 시점이 늦어 초기 이익 놓치거나 손실 확대 가능

## 5.3 실전 구현

이번 챕터의 코드에서는 다음을 구현합니다:

1. **SMA 크로스오버 전략**: 50일/200일 SMA를 사용한 골든/데드 크로스
2. **EMA 크로스오버 전략**: 50일/200일 EMA를 사용한 크로스오버
3. **성과 비교**: Buy & Hold vs. SMA 전략 vs. EMA 전략

### 5.3.1 Backtrader에서 이동평균 사용

```python
import backtrader as bt

class MovingAverageCrossStrategy(bt.Strategy):
    params = (
        ('fast_period', 50),
        ('slow_period', 200),
    )

    def __init__(self):
        # SMA 계산
        self.fast_ma = bt.indicators.SMA(
            self.data.close,
            period=self.params.fast_period
        )
        self.slow_ma = bt.indicators.SMA(
            self.data.close,
            period=self.params.slow_period
        )

        # 크로스오버 신호
        self.crossover = bt.indicators.CrossOver(
            self.fast_ma,
            self.slow_ma
        )
```

### 5.3.2 거래 로직

```python
def next(self):
    if self.crossover > 0:  # 골든 크로스
        if not self.position:
            self.buy()
    elif self.crossover < 0:  # 데드 크로스
        if self.position:
            self.close()
```

## 5.4 실행 결과

**⚠️ Chapter 1에서 경고한 현실이 여기 있습니다!**

> "대부분의 기술적 지표 전략은 강세장에서 Buy & Hold를 이기지 못합니다"

이제 그 증거를 직접 확인해봅시다.

코드를 실행한 결과입니다 (Apple Inc., 2019-2024):

```
==================================================
Chapter 5: 이동평균 전략
==================================================

=== 백테스트 설정 ===
- 티커: AAPL
- 기간: 2019-01-01 ~ 2024-01-01
- 초기 자금: $10,000.00
- 수수료: 0.1%
- 전략: SMA(50/200), EMA(50/200) 크로스오버

==================================================
백테스트 실행 중...
==================================================

[1/3] SMA 전략 실행 중...

==================================================
=== SMA(50/200) 크로스오버 성과 ===
==================================================

기본 지표:
- 초기 자금: $10,000.00
- 최종 자금: $11,106.95
- 총 수익률: +11.07%

Sharpe Ratio: 0.266

최대 낙폭:
- Max Drawdown: 14.41%
- DD Duration: 152 days

수익률:
- Total Return: +10.50%
- Annualized Return: 2.13%

거래 통계:
- 총 거래: 2
- 승: 0, 패: 1
- 승률: 0.0%
- 평균 손실: $-794.75

[2/3] EMA 전략 실행 중...

==================================================
=== EMA(50/200) 크로스오버 성과 ===
==================================================

기본 지표:
- 초기 자금: $10,000.00
- 최종 자금: $10,521.69
- 총 수익률: +5.22%

Sharpe Ratio: 0.142

최대 낙폭:
- Max Drawdown: 19.98%
- DD Duration: 214 days

수익률:
- Total Return: +5.09%
- Annualized Return: 1.02%

거래 통계:
- 총 거래: 2
- 승: 0, 패: 1
- 승률: 0.0%
- 평균 손실: $-1469.57

[3/3] Buy & Hold 벤치마크 계산 중...

==================================================
=== Buy & Hold 벤치마크 ===
==================================================
- 초기 자금: $10,000.00
- 최종 자금: $50,808.41
- 총 수익률: +408.08%

==================================================
=== 전략 비교 요약 ===
==================================================

Buy & Hold:     +408.08%
SMA(50/200):    +11.07%
EMA(50/200):    +5.22%

Buy & Hold 대비:
- SMA 초과 수익: -397.01%
- EMA 초과 수익: -402.87%
```

![이동평균 크로스오버 전략 비교](/images/chapter05/moving_average_strategy.png)

### 차트 해석

**상단 패널 - SMA(50/200) 크로스오버**:
- 초록색 삼각형(▲)은 골든 크로스 매수 신호를 나타냅니다
- 빨간색 역삼각형(▼)은 데드 크로스 매도 신호를 나타냅니다
- 2019-2024 기간 동안 골든/데드 크로스가 매우 드물게 발생했습니다
- 50일 SMA(주황선)가 200일 SMA(초록선)를 따라 움직이며, 교차 시점에서 신호가 발생합니다

**중간 패널 - EMA(50/200) 크로스오버**:
- EMA는 SMA보다 최근 가격 변동에 더 민감하게 반응합니다
- EMA 곡선이 SMA보다 더 부드럽고 가격에 근접하게 움직입니다
- 크로스오버 신호 발생 시점이 SMA와 약간 다릅니다
- EMA의 빠른 반응성이 장점이자 단점으로 작용할 수 있습니다

**하단 패널 - 성과 비교**:
- Buy & Hold 전략(파란선)이 압도적으로 높은 수익률을 기록했습니다
- Apple 주식이 2019-2024 기간 동안 강한 상승 추세를 보였습니다
- 이동평균 크로스오버 전략은 대부분 시장 밖에 있어 큰 상승을 놓쳤습니다

## 5.5 핵심 인사이트: 수익성의 냉혹한 진실

**이것이 현실입니다**: 유명한 골든크로스 전략이 단순히 사서 보유하는 것보다 **97% 낮은** 수익을 냈습니다.

| 전략 | 수익률 | vs Buy & Hold | 판정 |
|------|--------|---------------|------|
| Buy & Hold | **+408.08%** | 기준 | ✅ 승자 |
| SMA(50/200) | +11.07% | -97% | ❌ 참패 |
| EMA(50/200) | +5.22% | -99% | ❌ 완패 |

**만약 이 책이 여기서 끝났다면**, 당신은 "퀀트 트레이딩은 쓸모없다"고 결론지었을 것입니다.

**하지만 잠깐!** 실행 결과에서 얻을 수 있는 중요한 교훈:

### 1. 강한 트렌드 시장의 역설

Apple 주식은 2019-2024 기간 동안 **+408%**의 압도적인 상승을 기록했습니다. 하지만 이동평균 크로스오버 전략은:
- SMA(50/200): +11.07%
- EMA(50/200): +5.22%

**왜 이런 결과가 나왔을까요?**
- **신호 지연**: 50일/200일 같은 장기 이동평균은 매우 느리게 반응합니다
- **거래 희소성**: 5년 동안 단 2회의 거래만 발생 (매수 1회, 매도 1회, 현재 보유 중)
- **시장 밖 대기**: 대부분의 기간을 현금으로 보유하며 상승장을 놓쳤습니다

### 2. SMA vs EMA 비교

- **SMA가 EMA보다 우수**: 11.07% vs 5.22%
- **Sharpe Ratio**: SMA(0.266) > EMA(0.142)
- **Maximum Drawdown**: SMA(14.41%) < EMA(19.98%)

**EMA의 민감성이 역효과**:
- 더 빠른 반응이 항상 좋은 것은 아닙니다
- 이 기간 동안 EMA의 빠른 매도 신호가 손실을 확대시켰습니다

### 3. 거래 빈도의 함정

- **총 거래: 2회** (5년 동안)
- **승률: 0%** (완료된 거래 1회가 손실)
- **평균 손실**: SMA $-794.75, EMA $-1,469.57

**문제점**:
- 샘플 사이즈가 너무 작아 통계적 의미가 없습니다
- 50/200일 같은 장기 MA는 거래 빈도가 극히 낮습니다
- 단 한 번의 잘못된 거래가 전체 성과를 좌우합니다

### 4. 이동평균 전략이 효과적인 경우

이 전략이 잘 작동하는 시장:
- **명확한 트렌드 전환**: 상승 → 하락 또는 하락 → 상승
- **횡보 후 추세 발생**: 장기간 횡보 후 강한 트렌드 시작
- **변동성이 낮은 시장**: 잦은 가격 변동이 없는 안정적 추세

이 전략이 실패하는 시장:
- **지속적 상승장**: Apple처럼 계속 오르는 시장 (항상 투자되어 있어야 함)
- **횡보장**: 이동평균 주변에서 진동하며 거짓 신호 빈발 (whipsaw)
- **급격한 변동**: 신호 발생 시점이 이미 늦어 손실 확대

### 5. 실전 적용 시 고려사항

**이 결과가 주는 교훈**:
- ✅ 이동평균 크로스오버는 **트렌드 반전**을 포착하는 도구
- ❌ 지속적 상승장에서는 Buy & Hold를 이기기 어렵습니다
- ⚠️ 50/200일은 너무 느립니다 → 더 짧은 기간(예: 20/50일) 고려
- ⚠️ 단일 지표에 의존하지 말고 필터 추가 필요
- ⚠️ 다양한 시장 환경(상승, 하락, 횡보)에서 테스트해야 합니다

## 5.6 개선 방향

이동평균 전략을 개선할 수 있는 방법:

1. **기간 최적화**: 50/200일이 아닌 다른 기간 조합 테스트
2. **필터 추가**: 거래량, 변동성 등 추가 조건으로 거짓 신호 필터링
3. **포지션 크기 조절**: 신호 강도에 따라 매수 비중 조절
4. **손절/익절**: 고정 비율 손절매와 익절매 설정
5. **다중 시간프레임**: 상위 시간프레임 트렌드 확인 후 진입

## 5.7 수익성 결론: 언제 이 전략을 사용해야 하는가?

**질문**: "SMA가 +11%인데 Buy & Hold가 +408%라면, 왜 이 전략을 배우는가?"

**답변**: 시장은 항상 상승하지 않기 때문입니다.

### 실전 수익성 시나리오

**시나리오 A: 강세장 (2019-2024 AAPL)**
```
Buy & Hold: +408% ← 승자
SMA(50/200): +11% ← 패자
```
**결론**: 이 시장에서는 Buy & Hold가 정답

**시나리오 B: 약세장 가정 (2008 금융위기 스타일)**
```
Buy & Hold: -50% ← 패자
SMA(50/200): -10% ← 승자 (손실을 줄임)
```
**결론**: 하락을 피하고 현금 보유로 방어

**시나리오 C: 횡보장 (10년간 제자리)**
```
Buy & Hold: 0% ← 시간 낭비
SMA(50/200): -5~+5% ← 거래 비용으로 손실
```
**결론**: 둘 다 실패, 다른 자산으로 이동 필요

### 실용적 수익성 전략

**Level 1: 초보자**
- 강세장 확신 → Buy & Hold
- 불확실 → 50% Buy & Hold + 50% 현금

**Level 2: 중급자**
- 시장 체제 감지 → 강세장은 Buy & Hold, 약세장은 SMA
- 포트폴리오 분할 → 70% Buy & Hold + 30% SMA (리스크 헷징)

**Level 3: 고급자**
- 다중 전략 조합 → 강세장/약세장/횡보장별 다른 전략
- 동적 자산 배분 → 시장 상황에 따라 전략 비중 조정

### 현실적 수익 기대치

만약 당신이 SMA(50/200) 전략을 실전에 사용한다면:

```
10년 백테스트 시뮬레이션 (다양한 시장):
- 강세장 5년: +50% (Buy & Hold 대비 -300%)
- 약세장 3년: -10% (Buy & Hold 대비 +40%)
- 횡보장 2년: -5% (Buy & Hold 대비 -5%)

총 10년 결과: +35%
Buy & Hold: +150%
```

**교훈**: 장기적으로는 여전히 Buy & Hold가 이김. 하지만:
- 약세장에서 큰 손실 회피 (심리적 안정)
- Max DD 감소 (32% → 15%)
- 더 나은 수면의 질 (가격 변동에 덜 민감)

**진짜 가치**: 수익률이 아니라 **위험 관리**에 있습니다.

## 다음 단계

다음 챕터에서는 RSI(Relative Strength Index)를 활용한 과매수/과매도 전략을 배웁니다. 이동평균이 추세 추종 전략이라면, RSI는 역추세(mean reversion) 전략의 대표적인 예입니다. **과연 RSI는 Buy & Hold를 이길 수 있을까요?** 결과를 직접 확인해봅시다!

---

**코드 실행:**
```bash
cd codes
uv run chapter05/01_moving_average_strategy.py
```
