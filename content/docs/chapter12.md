---
title: "Chapter 12: 성과 지표와 리스크 측정"
weight: 12
bookToc: true
---

# Chapter 12: 성과 지표와 리스크 측정

## 12.1 소개

백테스팅 전략의 성과를 평가하는 것은 매우 중요합니다. 단순히 수익률만 보는 것이 아니라, 얼마나 큰 리스크를 감수했는지, 수익의 일관성은 어떠한지 등을 종합적으로 평가해야 합니다.

이 장에서는 다양한 성과 지표와 리스크 측정 방법을 학습하고, 이를 Python으로 계산하는 방법을 알아봅니다.

## 12.2 수익률 지표

### 12.2.1 총 수익률 (Total Return)

총 수익률은 투자 기간 동안의 전체 수익률을 나타냅니다:

$$TR = \frac{V_{\text{end}} - V_{\text{start}}}{V_{\text{start}}}$$

여기서:
- $V_{\text{end}}$: 기말 포트폴리오 가치
- $V_{\text{start}}$: 기초 포트폴리오 가치

### 12.2.2 연환산 수익률 (Annualized Return)

서로 다른 기간의 전략을 비교하기 위해서는 연환산 수익률을 사용합니다:

$$AR = \left(1 + TR\right)^{\frac{365}{n}} - 1$$

여기서 $n$은 투자 일수입니다.

### 12.2.3 복합 연평균 성장률 (CAGR)

CAGR은 연환산 수익률과 유사하지만, 복리 효과를 고려합니다:

$$CAGR = \left(\frac{V_{\text{end}}}{V_{\text{start}}}\right)^{\frac{1}{T}} - 1$$

여기서 $T$는 투자 연수입니다.

## 12.3 리스크 지표

### 12.3.1 변동성 (Volatility)

변동성은 수익률의 표준편차로 측정됩니다:

$$\sigma = \sqrt{\frac{1}{n-1} \sum_{i=1}^{n} (r_i - \bar{r})^2}$$

연환산 변동성:

$$\sigma_{\text{annual}} = \sigma_{\text{daily}} \times \sqrt{252}$$

### 12.3.2 최대 낙폭 (Maximum Drawdown, MDD)

최대 낙폭은 피크에서 저점까지의 최대 하락폭을 나타냅니다:

$$MDD = \max_{t} \left( \frac{\text{Peak}_t - \text{Valley}_t}{\text{Peak}_t} \right)$$

최대 낙폭은 전략의 최악의 손실 시나리오를 보여줍니다.

### 12.3.3 낙폭 지속 기간 (Drawdown Duration)

최대 낙폭에서 회복하는 데 걸린 시간도 중요한 지표입니다.

## 12.4 리스크 조정 수익률

### 12.4.1 샤프 비율 (Sharpe Ratio)

샤프 비율은 위험 대비 초과 수익률을 측정합니다:

$$\text{Sharpe Ratio} = \frac{E[R_p - R_f]}{\sigma_p}$$

여기서:
- $R_p$: 포트폴리오 수익률
- $R_f$: 무위험 수익률 (일반적으로 국채 수익률)
- $\sigma_p$: 포트폴리오 수익률의 표준편차

**해석**:
- Sharpe Ratio > 1: 양호
- Sharpe Ratio > 2: 매우 좋음
- Sharpe Ratio > 3: 우수

### 12.4.2 소르티노 비율 (Sortino Ratio)

소르티노 비율은 하방 리스크만을 고려합니다:

$$\text{Sortino Ratio} = \frac{E[R_p - R_f]}{\sigma_{\text{downside}}}$$

여기서 $\sigma_{\text{downside}}$는 목표 수익률 이하의 수익률에 대한 표준편차입니다:

$$\sigma_{\text{downside}} = \sqrt{\frac{1}{n} \sum_{i=1}^{n} \min(0, r_i - \text{MAR})^2}$$

MAR (Minimum Acceptable Return)은 보통 0 또는 무위험 수익률을 사용합니다.

### 12.4.3 칼마 비율 (Calmar Ratio)

칼마 비율은 연환산 수익률을 최대 낙폭으로 나눈 값입니다:

$$\text{Calmar Ratio} = \frac{CAGR}{|MDD|}$$

최대 손실 대비 수익률을 평가합니다.

## 12.5 거래 통계

### 12.5.1 승률 (Win Rate)

$$\text{Win Rate} = \frac{\text{Number of Winning Trades}}{\text{Total Number of Trades}}$$

### 12.5.2 Profit Factor

$$\text{Profit Factor} = \frac{\text{Total Profit from Winning Trades}}{|\text{Total Loss from Losing Trades}|}$$

Profit Factor > 1이면 수익성 있는 전략입니다.

### 12.5.3 기댓값 (Expectancy)

거래당 평균 기댓값:

$$E = (P_w \times \text{Avg Win}) - (P_l \times \text{Avg Loss})$$

여기서:
- $P_w$: 승률
- $P_l$: 패율 $(1 - P_w)$

### 12.5.4 평균 거래 수익률

$$\text{Avg Trade Return} = \frac{\sum \text{Trade Returns}}{\text{Total Number of Trades}}$$

## 12.6 벤치마크 대비 성과

### 12.6.1 알파 (Alpha)

알파는 벤치마크 대비 초과 수익률을 나타냅니다:

$$\alpha = R_p - [R_f + \beta \times (R_m - R_f)]$$

여기서:
- $R_m$: 시장 수익률
- $\beta$: 시스템적 리스크

### 12.6.2 베타 (Beta)

베타는 시장 대비 민감도를 나타냅니다:

$$\beta = \frac{\text{Cov}(R_p, R_m)}{\text{Var}(R_m)}$$

## 12.7 실습: 종합 성과 분석 대시보드

이제 실제로 이러한 지표들을 계산하고 분석하는 코드를 작성해보겠습니다.

### 코드 예제

`codes/chapter12/01_performance_metrics.py`에서는 다음을 구현합니다:

1. **기본 수익률 지표**: Total Return, Annualized Return, CAGR
2. **리스크 지표**: Volatility, Maximum Drawdown, Drawdown Duration
3. **리스크 조정 수익률**: Sharpe, Sortino, Calmar Ratio
4. **거래 통계**: Win Rate, Profit Factor, Expectancy
5. **종합 대시보드**: 모든 지표를 한눈에 볼 수 있는 리포트

### 주요 결과 해석

성과 분석 시 주의할 점:

1. **단일 지표에 의존하지 말 것**: 여러 지표를 종합적으로 고려해야 합니다.
2. **샤프 비율의 한계**: 수익률이 정규분포를 따른다고 가정합니다.
3. **최대 낙폭**: 과거 최악의 시나리오가 미래에도 최악의 시나리오는 아닙니다.
4. **승률 vs. 손익비**: 높은 승률보다 높은 Profit Factor가 더 중요할 수 있습니다.

## 12.8 성과 지표 선택 가이드

| 목적 | 추천 지표 |
|------|----------|
| 절대 수익 평가 | CAGR, Total Return |
| 리스크 평가 | Maximum Drawdown, Volatility |
| 리스크 대비 수익 | Sharpe Ratio, Calmar Ratio |
| 하방 리스크 중점 | Sortino Ratio, Maximum Drawdown |
| 거래 효율성 | Win Rate, Profit Factor, Expectancy |
| 시장 대비 성과 | Alpha, Beta, Information Ratio |

## 12.9 요약

이 장에서는 다음을 학습했습니다:

1. **수익률 지표**: 총 수익률, 연환산 수익률, CAGR
2. **리스크 지표**: 변동성, 최대 낙폭, 낙폭 지속 기간
3. **리스크 조정 수익률**: Sharpe, Sortino, Calmar Ratio
4. **거래 통계**: 승률, Profit Factor, 기댓값
5. **벤치마크 대비 성과**: Alpha, Beta

다음 장에서는 이러한 지표들을 시각화하고, 백테스트 결과를 종합적으로 분석하는 방법을 학습합니다.

## 12.8 실행 결과

실제로 스크립트를 실행한 결과입니다:

```
==========================================
Chapter 12: 성과 지표와 리스크 측정
==========================================
테스트 기간: 2020-01-01 ~ 2024-12-31 (NVDA)
전략: SMA 50/200 골든크로스

==========================================
기본 수익률 지표
==========================================
초기 자산: $10,000.00
최종 자산: $10,002.98
총 수익률: +0.03%
연환산 수익률: +0.01%
CAGR: +0.01%

==========================================
리스크 지표
==========================================
연환산 변동성: 58.23%
최대 낙폭 (MDD): -56.93%
MDD 발생 기간: 2021-11-22 ~ 2022-10-13
MDD 지속 기간: 325일
회복 기간: 아직 회복 안 됨

==========================================
리스크 조정 수익률
==========================================
Sharpe Ratio: 0.01 (매우 낮음)
Sortino Ratio: 0.01
Calmar Ratio: 0.00

==========================================
거래 통계
==========================================
총 거래 수: 1
승리 거래: 0
패배 거래: 0
승률: N/A (거래 미완료)
평균 거래 수익률: N/A
Profit Factor: N/A
기댓값: N/A

==========================================
벤치마크 대비 성과
==========================================
Buy & Hold 수익률: +2,435.67%
전략 대비: -2,435.64%p 언더퍼폼

==========================================
성과 평가
==========================================
✗ Sharpe Ratio < 1 (목표: > 1)
✗ 승률 데이터 부족 (목표: > 45%)
✗ 최대 낙폭 과다 (목표: < -30%)
✗ 거래 수 부족 (목표: > 100)
✗ Buy & Hold 언더퍼폼

결론: 이 전략은 NVDA에 적합하지 않음

==========================================
결과 저장 완료
==========================================
차트: codes/chapter12/images/performance_dashboard.png
```

![성과 지표 대시보드](/images/chapter12/performance_dashboard.png)

### 차트 해석

**좌상단 패널 - Equity Curve (자산 곡선)**:
- **전략 (파란선)**: 2020년 초부터 완만한 하락 후 횡보, 거의 원금 수준(+0.03%)에 머물러 있습니다
- **Buy & Hold (빨간선)**: 급격한 상승을 보여 +2,435.67%의 놀라운 수익을 기록했습니다
- **격차**: 전략과 벤치마크 간 엄청난 격차가 발생했습니다. SMA 장기 전략이 NVDA의 폭발적 상승을 전혀 포착하지 못했습니다

**우상단 패널 - Drawdown (낙폭)**:
- **최대 낙폭**: -56.93%로 매우 심각한 수준입니다
- **발생 기간**: 2021년 11월부터 2022년 10월까지 약 325일간 지속되었습니다
- **미회복**: 2024년 말까지도 이전 고점을 회복하지 못했습니다
- 전략이 2021년 NVDA 고점 부근에서 매수 신호를 생성했고, 이후 하락장에서 큰 손실을 입은 것으로 추정됩니다

**좌하단 패널 - 월별 수익률 히트맵**:
- 대부분의 월이 **회색(0% 근처)** 또는 **파란색(마이너스)**로 표시되어 있습니다
- 거의 모든 기간에서 손실 또는 제자리걸음을 했습니다
- 몇 개의 초록색 월도 있지만(+5% 이하) 손실을 만회하기에 부족했습니다

**우하단 패널 - 수익률 분포 히스토그램**:
- 일별 수익률이 **0%를 중심으로 좁게 분포**되어 있습니다
- 극단적인 양수/음수 수익률이 거의 없습니다
- 이는 전략이 **대부분 시장에 진입하지 않았거나** 최소한의 포지션만 유지했음을 의미합니다

### 핵심 인사이트

**1. 전략과 자산의 미스매치**
- SMA 50/200 골든크로스는 **장기 추세 추종 전략**입니다
- NVDA는 2020-2024년 동안 **변동성이 극심한 성장주**였습니다
- 급등락을 반복하는 종목에 장기 이동평균은 너무 느리고 둔감합니다

**2. 신호 생성 부족**
- **거래 수: 1회** → 전략이 거의 신호를 생성하지 않았습니다
- 200일 이동평균은 너무 느려서 NVDA의 빠른 움직임을 따라잡지 못했습니다
- 대부분의 기간을 시장 밖에서 보냈고, 폭발적 상승을 놓쳤습니다

**3. 잘못된 타이밍**
- 전략이 1회 거래를 했지만 타이밍이 최악이었던 것으로 보입니다
- 2021년 고점 부근에서 매수 → 2022년 하락장에서 -56.93% 손실
- 이후 회복 신호가 없어 포지션을 청산하지 못했습니다

**4. 변동성 불일치**
- **전략 변동성**: 58.23% (연환산) → 매우 높음
- **Sharpe Ratio**: 0.01 → 변동성 대비 수익이 거의 없음
- 높은 리스크를 감수했지만 보상은 없었습니다

**5. Calmar Ratio = 0.00의 의미**
- Calmar Ratio = CAGR / |MDD| = 0.01% / 56.93% ≈ 0
- 최대 낙폭 대비 수익이 사실상 없습니다
- 리스크 관리가 전혀 작동하지 않았습니다

**6. Buy & Hold와의 비교**
- **Buy & Hold**: +2,435.67% → 24배 성장
- **전략**: +0.03% → 원금 유지
- **격차**: 2,435.64%p 언더퍼폼
- NVDA 같은 폭발적 성장주는 단순 보유가 최고의 전략이었습니다

### 이 결과가 주는 교훈

**1. 전략 선택의 중요성**
- 모든 전략이 모든 종목에 맞는 것은 아닙니다
- **성장주**: 단기 전략, 추세 돌파 전략
- **안정주**: 장기 전략, 배당 전략

**2. 백테스팅의 가치**
- 이런 나쁜 결과를 **실전 전에 발견**할 수 있었습니다
- 백테스팅으로 "이 전략 + 이 종목 = 부적합"을 확인했습니다
- 실전 손실을 막았습니다!

**3. 성과 지표의 통합 평가**
- 단일 지표만 보면 안 됩니다
- Sharpe Ratio, MDD, 거래 수, 승률 등을 종합 평가해야 합니다
- 이 전략은 **모든 기준에서 불합격**이었습니다

**4. 벤치마크의 중요성**
- Buy & Hold와 비교하지 않았다면 전략이 "손해는 아니네"로 착각할 수 있습니다
- 실제로는 2,435% 기회비용을 놓친 것입니다

**5. 변동성 종목의 특수성**
- NVDA는 일반적인 종목이 아닙니다 (AI 붐, 반도체 슈퍼사이클)
- 극단적 성장주는 전통적 기술적 분석이 잘 안 먹힙니다
- "Trend is your friend, until it ends" → NVDA는 트렌드가 끝나지 않았습니다

**6. 지표의 경고 신호**
- ✗ Sharpe < 1: 즉시 전략 재검토
- ✗ MDD > -50%: 리스크 관리 실패
- ✗ 거래 수 < 10: 신호 생성 부족
- ✗ 벤치마크 언더퍼폼: 전략 가치 없음

### 개선 방향

**이 전략을 개선하려면**:

1. **더 짧은 이동평균**: SMA 10/50 또는 EMA 12/26 (MACD)
2. **추가 필터**: RSI, 볼린저밴드로 진입 타이밍 개선
3. **손절매 추가**: ATR 기반 2-3배 손절매
4. **포지션 사이징**: 변동성에 따라 포지션 크기 조절
5. **종목 변경**: 덜 변동적인 종목 (예: S&P 500 ETF)

**또는**:
- 이 전략을 NVDA에 사용하지 않고, 적합한 종목 찾기
- 예: 배당주, 대형 안정주, 섹터 ETF

## 연습 문제

1. 승률이 40%인 전략과 60%인 전략 중 어느 것이 더 나을까요? (힌트: Profit Factor 고려)
2. Sharpe Ratio가 높지만 Maximum Drawdown도 큰 전략과, Sharpe Ratio는 낮지만 MDD도 작은 전략 중 어느 것을 선택하시겠습니까?
3. 실제 주식 전략의 Sharpe Ratio를 계산하고, 1 이상인지 확인해보세요.
