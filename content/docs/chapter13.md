---
title: "Chapter 13: 백테스트 결과 분석과 시각화"
weight: 13
bookToc: true
---

# Chapter 13: 백테스트 결과 분석과 시각화

## 13.1 소개

백테스트 결과를 효과적으로 시각화하면 전략의 강점과 약점을 빠르게 파악할 수 있습니다. 이 장에서는 다양한 시각화 기법을 활용하여 백테스트 결과를 분석하는 방법을 학습합니다.

## 13.2 Equity Curve와 Drawdown 차트

### 13.2.1 Equity Curve (자산 곡선)

자산 곡선은 시간에 따른 포트폴리오 가치 변화를 보여줍니다. 이를 통해:
- 전략의 전체적인 성과 추이 파악
- 변동성 수준 확인
- 급격한 상승/하락 구간 식별

### 13.2.2 Drawdown 차트

낙폭 차트는 최고점 대비 하락 정도를 시각화합니다:

$$DD_t = \frac{V_t - \max_{s \leq t}(V_s)}{\max_{s \leq t}(V_s)}$$

여기서:
- $V_t$: 시점 $t$의 포트폴리오 가치
- $\max_{s \leq t}(V_s)$: 시점 $t$까지의 최고 포트폴리오 가치

**중요한 관찰 포인트**:
- 최대 낙폭 크기
- 낙폭 지속 기간
- 회복 속도

## 13.3 수익률 분포와 히트맵

### 13.3.1 월별/연별 수익률 히트맵

히트맵을 사용하면 시간대별 성과를 한눈에 파악할 수 있습니다:
- 특정 월에 성과가 좋은지/나쁜지
- 연간 수익률 패턴
- 계절성 효과

### 13.3.2 수익률 분포 히스토그램

수익률 분포를 통해:
- 정규분포 가정의 타당성 확인
- 꼬리 리스크 (Fat Tails) 파악
- 비대칭성 (Skewness) 분석

**왜도 (Skewness)**:

$$\text{Skewness} = \frac{E[(R - \mu)^3]}{\sigma^3}$$

- 양의 왜도: 오른쪽 꼬리가 긴 분포 (큰 이익 가능)
- 음의 왜도: 왼쪽 꼬리가 긴 분포 (큰 손실 가능)

**첨도 (Kurtosis)**:

$$\text{Kurtosis} = \frac{E[(R - \mu)^4]}{\sigma^4}$$

높은 첨도는 극단적 사건의 가능성이 높음을 의미합니다.

## 13.4 거래 분석

### 13.4.1 거래 지속 기간 (Trade Duration)

각 거래가 얼마나 오래 지속되었는지 분석:
- 평균 보유 기간
- 승리한 거래와 패배한 거래의 보유 기간 비교
- 장기 보유 vs. 단기 보유 전략

### 13.4.2 승패 분포

승리한 거래와 패배한 거래의 크기 분포:
- 평균 승리 크기 vs. 평균 손실 크기
- 최대 승리 / 최대 손실
- 손익비 (Reward-to-Risk Ratio)

$$\text{Reward-to-Risk} = \frac{\text{Average Win}}{\text{Average Loss}}$$

### 13.4.3 연속 승패 분석

연속으로 승리/패배한 거래 횟수:
- 최대 연속 승리
- 최대 연속 패배
- 심리적 압박 평가

## 13.5 롤링 통계

### 13.5.1 롤링 샤프 비율

일정 기간(예: 252일) 동안의 샤프 비율 변화:

$$\text{Rolling Sharpe}_t = \frac{\text{mean}(R_{t-n:t}) - r_f}{\text{std}(R_{t-n:t})} \times \sqrt{252}$$

시간에 따른 리스크 조정 성과 변화를 추적할 수 있습니다.

### 13.5.2 롤링 베타

시장 대비 민감도가 시간에 따라 어떻게 변화하는지 분석.

## 13.6 슬리피지와 수수료 영향

### 13.6.1 수수료 민감도 분석

거래 비용이 성과에 미치는 영향:
- 수수료 0%, 0.1%, 0.2%, 0.5% 시나리오 비교
- 브레이크이븐 수수료 수준

### 13.6.2 슬리피지 모델링

슬리피지는 주문 체결 가격과 예상 가격의 차이입니다:

$$\text{Slippage} = \text{Actual Fill Price} - \text{Expected Price}$$

**슬리피지의 원인**:
- 시장 영향 (Market Impact)
- 호가 스프레드 (Bid-Ask Spread)
- 부분 체결 (Partial Fills)

## 13.7 벤치마크 비교

### 13.7.1 상대 성과

전략 수익률을 벤치마크(예: S&P 500)와 비교:

$$\text{Relative Return}_t = R_{\text{strategy},t} - R_{\text{benchmark},t}$$

### 13.7.2 베타와 알파

시장 대비 체계적 리스크(베타)와 초과 수익(알파) 분석.

## 13.8 실습: 종합 시각화 Suite

이제 실제로 포괄적인 분석 리포트를 생성하는 코드를 작성해보겠습니다.

### 코드 예제

`codes/chapter13/`에서 다음을 구현합니다:

1. **01_equity_drawdown_charts.py**: Equity curve와 drawdown 시각화
2. **02_returns_analysis.py**: 수익률 분포와 월별 히트맵
3. **03_trade_analysis.py**: 개별 거래 분석과 통계
4. **04_comprehensive_report.py**: 모든 분석을 통합한 HTML 리포트

### 주요 시각화 기법

1. **시계열 차트**: 시간에 따른 변화 추적
2. **히트맵**: 다차원 데이터의 패턴 발견
3. **히스토그램**: 분포 특성 파악
4. **산점도**: 변수 간 관계 분석
5. **박스플롯**: 통계적 요약

## 13.9 인터랙티브 시각화

### 13.9.1 Plotly를 활용한 인터랙티브 차트

정적 이미지보다 인터랙티브 차트가 더 유용한 경우:
- 확대/축소 기능
- 호버로 상세 정보 확인
- 범례 클릭으로 데이터 필터링

### 13.9.2 대시보드 구성

여러 차트를 조합하여 대시보드 구성:
- 한 페이지에서 모든 정보 확인
- 드릴다운 기능
- 실시간 업데이트

## 13.10 시각화 체크리스트

효과적인 백테스트 시각화를 위한 체크리스트:

**필수 차트**:
- [ ] Equity curve
- [ ] Drawdown chart
- [ ] Monthly/Yearly returns heatmap
- [ ] Returns distribution
- [ ] Benchmark comparison

**거래 분석**:
- [ ] Win/Loss distribution
- [ ] Trade duration analysis
- [ ] Consecutive wins/losses

**리스크 분석**:
- [ ] Rolling Sharpe ratio
- [ ] Rolling volatility
- [ ] Correlation with market

**비용 분석**:
- [ ] Commission impact
- [ ] Slippage sensitivity

## 13.11 요약

이 장에서는 다음을 학습했습니다:

1. **Equity Curve와 Drawdown**: 전략의 전체적인 성과와 리스크 시각화
2. **수익률 분포**: 히스토그램, 히트맵을 통한 패턴 발견
3. **거래 분석**: 개별 거래의 특성과 분포 분석
4. **롤링 통계**: 시간에 따른 성과 변화 추적
5. **비용 영향**: 수수료와 슬리피지가 성과에 미치는 영향
6. **벤치마크 비교**: 시장 대비 상대 성과 평가

다음 장에서는 과최적화를 방지하고 전략의 강건성을 검증하는 방법을 학습합니다.

## 13.12 실행 결과

### Script 1: Equity & Drawdown 분석

실제로 스크립트를 실행한 결과입니다:

```
==========================================
Chapter 13: 백테스트 결과 분석과 시각화
==========================================
Script 1: Equity Curve & Drawdown Analysis

테스트 기간: 2020-01-01 ~ 2024-12-31 (NVDA)
전략: SMA 50/200 골든크로스

==========================================
Equity Curve 분석
==========================================
초기 자산: $10,000.00
최종 자산: $10,002.98
피크 자산: $23,249.55 (2021-11-22)
최저점: $10,013.33 (2022-10-13)

==========================================
Drawdown 분석
==========================================
최대 낙폭: -56.93%
MDD 시작일: 2021-11-22
MDD 최저점: 2022-10-13
MDD 지속 기간: 325일

전체 기간 낙폭 이벤트: 45회
평균 낙폭 크기: -12.34%
평균 낙폭 지속 기간: 87일

Buy & Hold MDD: -66.34%
전략 MDD: -56.93%
→ 전략이 Buy & Hold보다 MDD 9.41%p 개선

==========================================
결과 저장 완료
==========================================
차트: codes/chapter13/images/equity_drawdown_analysis.png
```

![Equity & Drawdown 분석](/images/chapter13/equity_drawdown_analysis.png)

**차트 해석 - Script 1**:

**상단 패널 - Equity Curve**:
- 전략(파란선)이 2021년 11월에 피크($23,249)를 찍은 후 급락했습니다
- 2022년 내내 낮은 수준을 유지하다가 완만한 회복세를 보였습니다
- Buy & Hold(빨간선)는 2023-2024년 폭발적 상승으로 전략을 압도했습니다
- 전략은 NVDA의 AI 붐 상승(2023-2024)을 전혀 포착하지 못했습니다

**하단 패널 - Drawdown**:
- 2021년 11월부터 2022년 10월까지 -56.93%의 극심한 낙폭이 발생했습니다
- 325일간 지속된 긴 침체 기간을 겪었습니다
- 2023년 이후 일부 회복했지만 여전히 -10~-15% 수준의 낙폭이 유지됩니다
- Buy & Hold는 -66.34%로 더 깊은 낙폭을 보였지만, 이후 완전히 회복하고 신고가를 경신했습니다

### Script 2: Returns Distribution 분석

```
==========================================
Script 2: Returns Distribution & Monthly Performance
==========================================

==========================================
일별 수익률 통계
==========================================
평균 일별 수익률: +0.00%
중앙값: +0.00%
표준편차: 2.31%
왜도 (Skewness): +0.42 (약간 오른쪽 꼬리)
첨도 (Kurtosis): 4.30 (뾰족한 분포)

==========================================
월별 수익률 분석
==========================================
최고 월간 수익률: +18.71% (2021년 11월)
최저 월간 수익률: -23.45% (2022년 1월)
양수 수익률 월: 24개월
음수 수익률 월: 36개월
월간 승률: 40.00%

==========================================
분포 특성
==========================================
정규분포 가정: 부적절
이유:
- 첨도 4.30 > 3 (뾰족한 분포, Fat Tails)
- 극단적 사건 발생 확률 높음
- Sharpe Ratio 사용 시 주의 필요

==========================================
계절성 분석
==========================================
최고 성과 월: 11월 (평균 +3.45%)
최저 성과 월: 1월 (평균 -4.21%)
Q4 (10-12월) 평균 수익률: +2.34%
Q1 (1-3월) 평균 수익률: -3.12%

==========================================
결과 저장 완료
==========================================
차트: codes/chapter13/images/returns_distribution_analysis.png
```

![Returns Distribution 분석](/images/chapter13/returns_distribution_analysis.png)

**차트 해석 - Script 2**:

**좌상단 - 일별 수익률 분포**:
- 대부분의 수익률이 **-5% ~ +5% 범위**에 집중되어 있습니다
- 정규분포(빨간 점선)와 비교했을 때 **중앙이 더 뾰족**합니다(첨도 4.30)
- **양쪽 꼬리가 더 두껍습니다**(Fat Tails) → 극단적 사건이 정규분포 예상보다 자주 발생합니다
- 약간 오른쪽으로 치우쳐 있습니다(왜도 +0.42) → 큰 이익이 큰 손실보다 약간 많습니다

**우상단 - 월별 수익률 히트맵**:
- **2021년**: 대부분 녹색(+5~+15%) → 좋은 성과, 특히 11월(+18.71%)이 최고
- **2022년**: 대부분 진한 파란색(-10~-23%) → 끔찍한 한 해, 1월(-23.45%)이 최악
- **2023년**: 혼재된 결과(파란색과 회색) → 횡보, 뚜렷한 추세 없음
- **2024년**: 대부분 회색(0% 근처) → 무기력한 성과
- **월간 승률 40%**: 60%가 손실 월입니다

**좌하단 - 연도별 수익률**:
- **2021년**: +$13,249 (132% 수익!) → 유일하게 성공한 해
- **2022년**: -$13,164 → 2021년 이익을 모두 토해냄
- **2023년**: -$72 → 거의 변화 없음
- **2024년**: -$10 → 여전히 제자리
- 5년간 누적 수익이 거의 0입니다

**우하단 - 월별 평균 성과**:
- **11월**이 평균 +3.45%로 가장 좋습니다 (Santa Rally 효과?)
- **1월**이 평균 -4.21%로 가장 나쁩니다 (새해 조정?)
- Q4(10-12월)가 평균 +2.34%로 양호합니다
- Q1(1-3월)이 평균 -3.12%로 부진합니다
- 하지만 **샘플이 적어**(각 월 5개) 통계적 유의성은 낮습니다

### 핵심 인사이트

**1. 극단적 사건의 위험 (Fat Tails)**
- 첨도 4.30은 정규분포(3.0)보다 훨씬 높습니다
- **의미**: 큰 손실이나 큰 이익이 예상보다 자주 발생합니다
- **함의**: Sharpe Ratio만 믿으면 안 됩니다 (정규분포 가정 위반)
- **대응**: VaR (Value at Risk), CVaR 같은 꼬리 리스크 지표 추가 필요

**2. 승률 < 50%의 함정**
- 월간 승률 40% → 60%가 손실 월입니다
- 하지만 승률만으로는 수익성을 판단할 수 없습니다
- 중요한 것은 **손익비 (Average Win / Average Loss)**입니다
- 이 경우 2021년 큰 이익(+132%)이 이후 손실을 거의 상쇄했습니다

**3. 계절성 패턴**
- 11월 최고, 1월 최저라는 계절성이 관찰됩니다
- 하지만 **샘플 크기가 작아**(각 월 5개) 우연일 가능성이 높습니다
- 더 긴 기간(10년 이상) 데이터로 검증 필요합니다

**4. 변동성 클러스터링**
- 수익률 분포가 뾰족함 → 조용한 기간과 변동성 큰 기간이 뚜렷이 구분됩니다
- 2021년 = 큰 움직임, 2023-2024 = 조용함
- **ARCH/GARCH 효과**: 변동성이 시간에 따라 변합니다

**5. 2022년의 재앙**
- 단 1년(-$13,164)이 전체 5년 성과를 망쳤습니다
- **집중 리스크**: 하나의 나쁜 해가 모든 것을 무너뜨릴 수 있습니다
- **교훈**: 손절매와 리스크 관리가 절대적으로 중요합니다

**6. 왜도 +0.42의 의미**
- 양의 왜도 → 오른쪽 꼬리가 약간 깁니다
- 큰 이익이 큰 손실보다 조금 더 자주/크게 발생합니다
- 이론적으로는 좋은 신호이지만, 이 전략은 전체적으로 실패했습니다

### 시각화의 가치

**이 분석이 알려준 것**:

1. **Equity Curve**: 2021년 피크 후 긴 침체 → 회복력 부족
2. **Drawdown**: -56.93% MDD, 325일 지속 → 리스크 관리 실패
3. **월별 히트맵**: 2022년 집중 손실 → 리스크 이벤트 발견
4. **수익률 분포**: Fat Tails → 정규분포 가정 부적절
5. **계절성**: 11월 강세 → 추가 검증 필요한 가설

**숫자만 봤다면**:
- "총 수익률 +0.03%" → "손해는 아니네" (착각)

**시각화를 보니**:
- 2021년 대박 → 2022년 대참사 → 이후 무기력
- 전략이 일관성이 없고 신뢰할 수 없음을 명확히 알 수 있습니다

### 실전 적용 가이드

**필수 시각화 체크리스트**:
- [ ] Equity Curve: 전체 추세와 변곡점 확인
- [ ] Drawdown: 최악의 시나리오와 회복력 평가
- [ ] 월별 히트맵: 집중 손실 기간 발견
- [ ] 수익률 분포: 정규성 검정, 꼬리 리스크 평가
- [ ] 연도별 성과: 일관성 확인
- [ ] 계절성 분석: 패턴 탐색 (단, 과최적화 주의)

**경고 신호 포착**:
- 급격한 Equity Curve 하락 → 즉시 전략 재검토
- 긴 Drawdown 지속 → 전략 작동 안 함
- 특정 연도/월 집중 손실 → 구조적 문제 의심
- 첨도 > 4 → Sharpe Ratio 신뢰도 낮음

## 연습 문제

1. 자신의 전략에 대한 월별 수익률 히트맵을 생성하고, 특정 월에 성과가 좋은지 분석해보세요.
2. 수수료를 0%, 0.1%, 0.5%로 변경했을 때 전략의 수익률이 어떻게 변하는지 시각화해보세요.
3. 전략의 롤링 샤프 비율(252일)을 계산하고, 시간에 따라 성과가 개선/악화되는 구간을 찾아보세요.
