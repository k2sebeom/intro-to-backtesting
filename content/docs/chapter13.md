---
title: "Chapter 13: 백테스트 결과 분석과 시각화"
weight: 13
bookToc: true
---

# Chapter 13: 백테스트 결과 분석과 시각화

## 13.1 소개

백테스트 결과를 효과적으로 시각화하면 전략의 강점과 약점을 빠르게 파악할 수 있습니다. 이 장에서는 다양한 시각화 기법을 활용하여 백테스트 결과를 분석하는 방법을 학습합니다.

## 13.2 Equity Curve와 Drawdown 차트

### 13.2.1 Equity Curve (자산 곡선)

자산 곡선은 시간에 따른 포트폴리오 가치 변화를 보여줍니다. 이를 통해:
- 전략의 전체적인 성과 추이 파악
- 변동성 수준 확인
- 급격한 상승/하락 구간 식별

### 13.2.2 Drawdown 차트

낙폭 차트는 최고점 대비 하락 정도를 시각화합니다:

$$DD_t = \frac{V_t - \max_{s \leq t}(V_s)}{\max_{s \leq t}(V_s)}$$

여기서:
- $V_t$: 시점 $t$의 포트폴리오 가치
- $\max_{s \leq t}(V_s)$: 시점 $t$까지의 최고 포트폴리오 가치

**중요한 관찰 포인트**:
- 최대 낙폭 크기
- 낙폭 지속 기간
- 회복 속도

## 13.3 수익률 분포와 히트맵

### 13.3.1 월별/연별 수익률 히트맵

히트맵을 사용하면 시간대별 성과를 한눈에 파악할 수 있습니다:
- 특정 월에 성과가 좋은지/나쁜지
- 연간 수익률 패턴
- 계절성 효과

### 13.3.2 수익률 분포 히스토그램

수익률 분포를 통해:
- 정규분포 가정의 타당성 확인
- 꼬리 리스크 (Fat Tails) 파악
- 비대칭성 (Skewness) 분석

**왜도 (Skewness)**:

$$\text{Skewness} = \frac{E[(R - \mu)^3]}{\sigma^3}$$

- 양의 왜도: 오른쪽 꼬리가 긴 분포 (큰 이익 가능)
- 음의 왜도: 왼쪽 꼬리가 긴 분포 (큰 손실 가능)

**첨도 (Kurtosis)**:

$$\text{Kurtosis} = \frac{E[(R - \mu)^4]}{\sigma^4}$$

높은 첨도는 극단적 사건의 가능성이 높음을 의미합니다.

## 13.4 거래 분석

### 13.4.1 거래 지속 기간 (Trade Duration)

각 거래가 얼마나 오래 지속되었는지 분석:
- 평균 보유 기간
- 승리한 거래와 패배한 거래의 보유 기간 비교
- 장기 보유 vs. 단기 보유 전략

### 13.4.2 승패 분포

승리한 거래와 패배한 거래의 크기 분포:
- 평균 승리 크기 vs. 평균 손실 크기
- 최대 승리 / 최대 손실
- 손익비 (Reward-to-Risk Ratio)

$$\text{Reward-to-Risk} = \frac{\text{Average Win}}{\text{Average Loss}}$$

### 13.4.3 연속 승패 분석

연속으로 승리/패배한 거래 횟수:
- 최대 연속 승리
- 최대 연속 패배
- 심리적 압박 평가

## 13.5 롤링 통계

### 13.5.1 롤링 샤프 비율

일정 기간(예: 252일) 동안의 샤프 비율 변화:

$$\text{Rolling Sharpe}_t = \frac{\text{mean}(R_{t-n:t}) - r_f}{\text{std}(R_{t-n:t})} \times \sqrt{252}$$

시간에 따른 리스크 조정 성과 변화를 추적할 수 있습니다.

### 13.5.2 롤링 베타

시장 대비 민감도가 시간에 따라 어떻게 변화하는지 분석.

## 13.6 슬리피지와 수수료 영향

### 13.6.1 수수료 민감도 분석

거래 비용이 성과에 미치는 영향:
- 수수료 0%, 0.1%, 0.2%, 0.5% 시나리오 비교
- 브레이크이븐 수수료 수준

### 13.6.2 슬리피지 모델링

슬리피지는 주문 체결 가격과 예상 가격의 차이입니다:

$$\text{Slippage} = \text{Actual Fill Price} - \text{Expected Price}$$

**슬리피지의 원인**:
- 시장 영향 (Market Impact)
- 호가 스프레드 (Bid-Ask Spread)
- 부분 체결 (Partial Fills)

## 13.7 벤치마크 비교

### 13.7.1 상대 성과

전략 수익률을 벤치마크(예: S&P 500)와 비교:

$$\text{Relative Return}_t = R_{\text{strategy},t} - R_{\text{benchmark},t}$$

### 13.7.2 베타와 알파

시장 대비 체계적 리스크(베타)와 초과 수익(알파) 분석.

## 13.8 실습: 종합 시각화 Suite

이제 실제로 포괄적인 분석 리포트를 생성하는 코드를 작성해보겠습니다.

### 코드 예제

`codes/chapter13/`에서 다음을 구현합니다:

1. **01_equity_drawdown_charts.py**: Equity curve와 drawdown 시각화
2. **02_returns_analysis.py**: 수익률 분포와 월별 히트맵
3. **03_trade_analysis.py**: 개별 거래 분석과 통계
4. **04_comprehensive_report.py**: 모든 분석을 통합한 HTML 리포트

### 주요 시각화 기법

1. **시계열 차트**: 시간에 따른 변화 추적
2. **히트맵**: 다차원 데이터의 패턴 발견
3. **히스토그램**: 분포 특성 파악
4. **산점도**: 변수 간 관계 분석
5. **박스플롯**: 통계적 요약

## 13.9 인터랙티브 시각화

### 13.9.1 Plotly를 활용한 인터랙티브 차트

정적 이미지보다 인터랙티브 차트가 더 유용한 경우:
- 확대/축소 기능
- 호버로 상세 정보 확인
- 범례 클릭으로 데이터 필터링

### 13.9.2 대시보드 구성

여러 차트를 조합하여 대시보드 구성:
- 한 페이지에서 모든 정보 확인
- 드릴다운 기능
- 실시간 업데이트

## 13.10 시각화 체크리스트

효과적인 백테스트 시각화를 위한 체크리스트:

**필수 차트**:
- [ ] Equity curve
- [ ] Drawdown chart
- [ ] Monthly/Yearly returns heatmap
- [ ] Returns distribution
- [ ] Benchmark comparison

**거래 분석**:
- [ ] Win/Loss distribution
- [ ] Trade duration analysis
- [ ] Consecutive wins/losses

**리스크 분석**:
- [ ] Rolling Sharpe ratio
- [ ] Rolling volatility
- [ ] Correlation with market

**비용 분석**:
- [ ] Commission impact
- [ ] Slippage sensitivity

## 13.11 요약

이 장에서는 다음을 학습했습니다:

1. **Equity Curve와 Drawdown**: 전략의 전체적인 성과와 리스크 시각화
2. **수익률 분포**: 히스토그램, 히트맵을 통한 패턴 발견
3. **거래 분석**: 개별 거래의 특성과 분포 분석
4. **롤링 통계**: 시간에 따른 성과 변화 추적
5. **비용 영향**: 수수료와 슬리피지가 성과에 미치는 영향
6. **벤치마크 비교**: 시장 대비 상대 성과 평가

다음 장에서는 과최적화를 방지하고 전략의 강건성을 검증하는 방법을 학습합니다.

## 연습 문제

1. 자신의 전략에 대한 월별 수익률 히트맵을 생성하고, 특정 월에 성과가 좋은지 분석해보세요.
2. 수수료를 0%, 0.1%, 0.5%로 변경했을 때 전략의 수익률이 어떻게 변하는지 시각화해보세요.
3. 전략의 롤링 샤프 비율(252일)을 계산하고, 시간에 따라 성과가 개선/악화되는 구간을 찾아보세요.
