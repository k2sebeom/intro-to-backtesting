<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Chapter 9: 포지션 크기 결정# 아무리 좋은 전략이라도 포지션 크기를 잘못 결정하면 큰 손실을 입거나 기회를 놓칠 수 있습니다. 이번 챕터에서는 계좌 크기와 위험 허용도에 맞게 포지션 크기를 결정하는 다양한 방법을 배웁니다.
9.1 포지션 크기의 중요성# 9.1.1 포지션 크기가 중요한 이유# 1. 위험 관리의 핵심
너무 큰 포지션: 한 번의 손실로 계좌 파산 가능 너무 작은 포지션: 수익 기회 미활용 2. 복리 효과
일정한 포지션 크기 유지 시 복리 효과 극대화 계좌 크기에 비례하여 포지션 조정 3. 심리적 안정
"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://k2sebeom.github.io/intro-to-backtesting/docs/chapter09/"><meta property="og:site_name" content="파이썬으로 배우는 백테스팅 입문"><meta property="og:title" content="Chapter 9: 포지션 크기 결정"><meta property="og:description" content="Chapter 9: 포지션 크기 결정# 아무리 좋은 전략이라도 포지션 크기를 잘못 결정하면 큰 손실을 입거나 기회를 놓칠 수 있습니다. 이번 챕터에서는 계좌 크기와 위험 허용도에 맞게 포지션 크기를 결정하는 다양한 방법을 배웁니다.
9.1 포지션 크기의 중요성# 9.1.1 포지션 크기가 중요한 이유# 1. 위험 관리의 핵심
너무 큰 포지션: 한 번의 손실로 계좌 파산 가능 너무 작은 포지션: 수익 기회 미활용 2. 복리 효과
일정한 포지션 크기 유지 시 복리 효과 극대화 계좌 크기에 비례하여 포지션 조정 3. 심리적 안정"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="docs"><meta property="article:modified_time" content="2026-02-05T02:35:22+00:00"><meta itemprop=name content="Chapter 9: 포지션 크기 결정"><meta itemprop=description content="Chapter 9: 포지션 크기 결정# 아무리 좋은 전략이라도 포지션 크기를 잘못 결정하면 큰 손실을 입거나 기회를 놓칠 수 있습니다. 이번 챕터에서는 계좌 크기와 위험 허용도에 맞게 포지션 크기를 결정하는 다양한 방법을 배웁니다.
9.1 포지션 크기의 중요성# 9.1.1 포지션 크기가 중요한 이유# 1. 위험 관리의 핵심
너무 큰 포지션: 한 번의 손실로 계좌 파산 가능 너무 작은 포지션: 수익 기회 미활용 2. 복리 효과
일정한 포지션 크기 유지 시 복리 효과 극대화 계좌 크기에 비례하여 포지션 조정 3. 심리적 안정"><meta itemprop=dateModified content="2026-02-05T02:35:22+00:00"><meta itemprop=wordCount content="2013"><title>Chapter 9: 포지션 크기 결정 | 파이썬으로 배우는 백테스팅 입문</title><link rel=icon href=/intro-to-backtesting/favicon.png><link rel=manifest href=/intro-to-backtesting/manifest.json><link rel=canonical href=https://k2sebeom.github.io/intro-to-backtesting/docs/chapter09/><link rel=stylesheet href=/intro-to-backtesting/book.min.cc2c524ed250aac81b23d1f4af87344917b325208841feca0968fe450f570575.css integrity="sha256-zCxSTtJQqsgbI9H0r4c0SRezJSCIQf7KCWj+RQ9XBXU=" crossorigin=anonymous><script defer src=/intro-to-backtesting/fuse.min.js></script><script defer src=/intro-to-backtesting/en.search.min.05baa5436ceb0d25fdc88cb36120167f2dcace5f2606a6e63ae01a885e2bbf68.js integrity="sha256-BbqlQ2zrDSX9yIyzYSAWfy3Kzl8mBqbmOuAaiF4rv2g=" crossorigin=anonymous></script><script id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@4/tex-mml-chtml.js></script><script>MathJax={tex:{displayMath:[["\\[","\\]"],["$$","$$"]],inlineMath:[["\\(","\\)"],["$","$"]]},loader:{load:["ui/safe"]}}</script></head><body dir=ltr class="book-kind-page book-type-docs"><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/intro-to-backtesting/><span>파이썬으로 배우는 백테스팅 입문</span></a></h2><div class="book-search hidden"><input id=book-search-input type=text placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script><ul><li><a href=/intro-to-backtesting/docs/chapter01/>Chapter 1: 백테스팅 시작하기</a></li><li><a href=/intro-to-backtesting/docs/chapter02/>Chapter 2: 금융 데이터 다운로드와 이해</a></li><li><a href=/intro-to-backtesting/docs/chapter03/>Chapter 3: 데이터 전처리와 수익률</a></li><li><a href=/intro-to-backtesting/docs/chapter04/>Chapter 4: Backtrader 프레임워크 기초</a></li><li><a href=/intro-to-backtesting/docs/chapter05/>Chapter 5: 이동평균 전략</a></li><li><a href=/intro-to-backtesting/docs/chapter06/>Chapter 6: RSI 및 과매수/과매도 전략</a></li><li><a href=/intro-to-backtesting/docs/chapter07/>Chapter 7: Bollinger Bands 전략</a></li><li><a href=/intro-to-backtesting/docs/chapter08/>Chapter 8: 다중 지표 결합 전략</a></li><li><a href=/intro-to-backtesting/docs/chapter09/ class=active>Chapter 9: 포지션 크기 결정</a></li><li><a href=/intro-to-backtesting/docs/chapter10/>Chapter 10: 리스크 관리와 손절매</a></li><li><a href=/intro-to-backtesting/docs/chapter11/>Chapter 11: 포트폴리오 구성과 분산투자</a></li><li><a href=/intro-to-backtesting/docs/chapter12/>Chapter 12: 성과 지표와 리스크 측정</a></li><li><a href=/intro-to-backtesting/docs/chapter13/>Chapter 13: 백테스트 결과 분석과 시각화</a></li><li><a href=/intro-to-backtesting/docs/chapter14/>Chapter 14: 과최적화 방지와 검증</a></li><li><a href=/intro-to-backtesting/docs/chapter15/>Chapter 15: 머신러닝 기반 전략 (1)</a></li><li><a href=/intro-to-backtesting/docs/chapter16/>Chapter 16: 머신러닝 기반 전략 (2)</a></li><li><a href=/intro-to-backtesting/docs/chapter17/>Chapter 17: 실전 트레이딩 고려사항</a></li><li><a href=/intro-to-backtesting/docs/chapter18/>Chapter 18: 완전한 전략 개발 프로세스</a></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class="book-header hidden"><div class="flex align-center justify-between"><label for=menu-control><img src=/intro-to-backtesting/icons/menu.svg class=book-icon alt=Menu></label><h3>Chapter 9: 포지션 크기 결정</h3><label for=toc-control><img src=/intro-to-backtesting/icons/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class=hidden><nav id=TableOfContents><ul><li><a href=#91-포지션-크기의-중요성>9.1 포지션 크기의 중요성</a><ul><li><a href=#911-포지션-크기가-중요한-이유>9.1.1 포지션 크기가 중요한 이유</a></li><li><a href=#912-포지션-크기의-기본-원칙>9.1.2 포지션 크기의 기본 원칙</a></li></ul></li><li><a href=#92-포지션-크기-결정-방법>9.2 포지션 크기 결정 방법</a><ul><li><a href=#921-고정-금액-fixed-amount>9.2.1 고정 금액 (Fixed Amount)</a></li><li><a href=#922-고정-비율-fixed-percentage>9.2.2 고정 비율 (Fixed Percentage)</a></li><li><a href=#923-고정-위험-fixed-risk>9.2.3 고정 위험 (Fixed Risk)</a></li><li><a href=#924-켈리-기준-kelly-criterion>9.2.4 켈리 기준 (Kelly Criterion)</a></li><li><a href=#925-변동성-기반-volatility-based>9.2.5 변동성 기반 (Volatility-Based)</a></li></ul></li><li><a href=#93-backtrader에서-포지션-크기-관리>9.3 Backtrader에서 포지션 크기 관리</a><ul><li><a href=#931-sizer-클래스>9.3.1 Sizer 클래스</a></li><li><a href=#932-커스텀-sizer-구현>9.3.2 커스텀 Sizer 구현</a></li></ul></li><li><a href=#94-실전-구현>9.4 실전 구현</a></li><li><a href=#95-기대-결과>9.5 기대 결과</a></li><li><a href=#96-분석-포인트>9.6 분석 포인트</a></li><li><a href=#97-포지션-크기-결정-시-주의사항>9.7 포지션 크기 결정 시 주의사항</a><ul><li><a href=#971-과도한-레버리지-피하기>9.7.1 과도한 레버리지 피하기</a></li><li><a href=#972-연속-손실-대비>9.7.2 연속 손실 대비</a></li><li><a href=#973-승률과-손익비-변화>9.7.3 승률과 손익비 변화</a></li><li><a href=#974-유동성-고려>9.7.4 유동성 고려</a></li></ul></li><li><a href=#98-실전-적용-가이드>9.8 실전 적용 가이드</a><ul><li><a href=#981-초보자-권장-설정>9.8.1 초보자 권장 설정</a></li><li><a href=#982-중급자-권장-설정>9.8.2 중급자 권장 설정</a></li><li><a href=#983-전문가-권장-설정>9.8.3 전문가 권장 설정</a></li></ul></li><li><a href=#99-포지션-크기-최적화>9.9 포지션 크기 최적화</a><ul><li><a href=#991-백테스팅을-통한-최적화>9.9.1 백테스팅을 통한 최적화</a></li><li><a href=#992-동적-포지션-조정>9.9.2 동적 포지션 조정</a></li></ul></li><li><a href=#910-실행-결과>9.10 실행 결과</a><ul><li><a href=#차트-해석>차트 해석</a></li><li><a href=#성과-분석-및-핵심-인사이트>성과 분석 및 핵심 인사이트</a></li></ul></li><li><a href=#911-개선-방향>9.11 개선 방향</a></li><li><a href=#다음-단계>다음 단계</a></li></ul></nav></aside></header><article class="markdown book-article"><h1 id=chapter-9-포지션-크기-결정>Chapter 9: 포지션 크기 결정<a class=anchor href=#chapter-9-%ed%8f%ac%ec%a7%80%ec%85%98-%ed%81%ac%ea%b8%b0-%ea%b2%b0%ec%a0%95>#</a></h1><p>아무리 좋은 전략이라도 포지션 크기를 잘못 결정하면 큰 손실을 입거나 기회를 놓칠 수 있습니다. 이번 챕터에서는 계좌 크기와 위험 허용도에 맞게 포지션 크기를 결정하는 다양한 방법을 배웁니다.</p><h2 id=91-포지션-크기의-중요성>9.1 포지션 크기의 중요성<a class=anchor href=#91-%ed%8f%ac%ec%a7%80%ec%85%98-%ed%81%ac%ea%b8%b0%ec%9d%98-%ec%a4%91%ec%9a%94%ec%84%b1>#</a></h2><h3 id=911-포지션-크기가-중요한-이유>9.1.1 포지션 크기가 중요한 이유<a class=anchor href=#911-%ed%8f%ac%ec%a7%80%ec%85%98-%ed%81%ac%ea%b8%b0%ea%b0%80-%ec%a4%91%ec%9a%94%ed%95%9c-%ec%9d%b4%ec%9c%a0>#</a></h3><p><strong>1. 위험 관리의 핵심</strong></p><ul><li>너무 큰 포지션: 한 번의 손실로 계좌 파산 가능</li><li>너무 작은 포지션: 수익 기회 미활용</li></ul><p><strong>2. 복리 효과</strong></p><ul><li>일정한 포지션 크기 유지 시 복리 효과 극대화</li><li>계좌 크기에 비례하여 포지션 조정</li></ul><p><strong>3. 심리적 안정</strong></p><ul><li>적절한 포지션 크기로 감정적 의사결정 방지</li><li>손실을 견딜 수 있는 수준 유지</li></ul><h3 id=912-포지션-크기의-기본-원칙>9.1.2 포지션 크기의 기본 원칙<a class=anchor href=#912-%ed%8f%ac%ec%a7%80%ec%85%98-%ed%81%ac%ea%b8%b0%ec%9d%98-%ea%b8%b0%eb%b3%b8-%ec%9b%90%ec%b9%99>#</a></h3><p><strong>원칙 1: 한 번의 거래로 전체 계좌의 1-2% 이상 위험에 노출하지 않기</strong></p><pre tabindex=0><code>예: 계좌 $10,000
→ 거래당 최대 위험: $100-$200</code></pre><p><strong>원칙 2: 계좌 크기에 비례하여 포지션 조정</strong></p><pre tabindex=0><code>계좌 $10,000 → 포지션 $9,500
계좌 $20,000 → 포지션 $19,000</code></pre><p><strong>원칙 3: 변동성에 따라 포지션 크기 조정</strong></p><pre tabindex=0><code>고변동성 자산 → 작은 포지션
저변동성 자산 → 큰 포지션</code></pre><h2 id=92-포지션-크기-결정-방법>9.2 포지션 크기 결정 방법<a class=anchor href=#92-%ed%8f%ac%ec%a7%80%ec%85%98-%ed%81%ac%ea%b8%b0-%ea%b2%b0%ec%a0%95-%eb%b0%a9%eb%b2%95>#</a></h2><h3 id=921-고정-금액-fixed-amount>9.2.1 고정 금액 (Fixed Amount)<a class=anchor href=#921-%ea%b3%a0%ec%a0%95-%ea%b8%88%ec%95%a1-fixed-amount>#</a></h3><p><strong>방법</strong>: 매번 동일한 금액 투자</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-python data-lang=python><span style=display:flex><span>position_size <span style=color:#f92672>=</span> fixed_amount  <span style=color:#75715e># 예: $5,000</span>
</span></span><span style=display:flex><span>shares <span style=color:#f92672>=</span> position_size <span style=color:#f92672>/</span> current_price</span></span></code></pre></div><p><strong>장점</strong>:</p><ul><li>단순하고 이해하기 쉬움</li><li>구현 간단</li></ul><p><strong>단점</strong>:</p><ul><li>계좌 크기 변화 무시</li><li>복리 효과 없음</li><li>위험 관리 어려움</li></ul><p><strong>적용 사례</strong>: 초보자, 소액 계좌</p><h3 id=922-고정-비율-fixed-percentage>9.2.2 고정 비율 (Fixed Percentage)<a class=anchor href=#922-%ea%b3%a0%ec%a0%95-%eb%b9%84%ec%9c%a8-fixed-percentage>#</a></h3><p><strong>방법</strong>: 계좌 크기의 일정 비율 투자</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-python data-lang=python><span style=display:flex><span>position_size <span style=color:#f92672>=</span> account_value <span style=color:#f92672>*</span> percentage  <span style=color:#75715e># 예: 95%</span>
</span></span><span style=display:flex><span>shares <span style=color:#f92672>=</span> position_size <span style=color:#f92672>/</span> current_price</span></span></code></pre></div><p><strong>장점</strong>:</p><ul><li>계좌 크기에 비례하여 자동 조정</li><li>복리 효과 발생</li><li>구현 간단</li></ul><p><strong>단점</strong>:</p><ul><li>변동성 고려 없음</li><li>연속 손실 시 빠른 계좌 감소</li></ul><p><strong>적용 사례</strong>: 가장 일반적인 방법, 장기 투자</p><h3 id=923-고정-위험-fixed-risk>9.2.3 고정 위험 (Fixed Risk)<a class=anchor href=#923-%ea%b3%a0%ec%a0%95-%ec%9c%84%ed%97%98-fixed-risk>#</a></h3><p><strong>방법</strong>: 거래당 위험을 계좌의 일정 비율로 제한</p>$$
\text{Position Size} = \frac{\text{Account Value} \times \text{Risk \%}}{\text{Entry Price} - \text{Stop Loss Price}}
$$<p><strong>예시</strong>:</p><pre tabindex=0><code>계좌: $10,000
위험 허용: 1% → $100
진입가: $100
손절가: $95
손실폭: $5

포지션 크기 = $100 / $5 = 20주
투자금액 = 20주 × $100 = $2,000</code></pre><p><strong>장점</strong>:</p><ul><li>명확한 위험 관리</li><li>손실을 정확히 제어</li><li>변동성 자동 반영</li></ul><p><strong>단점</strong>:</p><ul><li>손절매 필수</li><li>계산 복잡</li></ul><p><strong>적용 사례</strong>: 전문 트레이더, 단기 매매</p><h3 id=924-켈리-기준-kelly-criterion>9.2.4 켈리 기준 (Kelly Criterion)<a class=anchor href=#924-%ec%bc%88%eb%a6%ac-%ea%b8%b0%ec%a4%80-kelly-criterion>#</a></h3><p><strong>방법</strong>: 최적 성장률을 위한 수학적 공식</p>$$
f^* = \frac{p \cdot (b + 1) - 1}{b}
$$<p>또는 더 간단하게:</p>$$
f^* = \frac{W - (1 - W)}{R}
$$<p>여기서:</p><ul><li>$f^*$: 투자할 자본 비율</li><li>$W$: 승률 (Win Rate)</li><li>$R$: 평균 승리/평균 손실 비율 (Reward/Risk Ratio)</li><li>$p$: 승률</li><li>$b$: 배당률 (net odds)</li></ul><p><strong>예시</strong>:</p><pre tabindex=0><code>승률 (W) = 60% = 0.6
평균 수익 = $300
평균 손실 = $150
R = $300 / $150 = 2

Kelly % = (0.6 - (1-0.6)) / 2 = (0.6 - 0.4) / 2 = 0.1 = 10%</code></pre><p><strong>장점</strong>:</p><ul><li>이론적으로 최적의 성장률</li><li>장기적으로 복리 최대화</li></ul><p><strong>단점</strong>:</p><ul><li>실전에서는 너무 공격적</li><li>승률과 손익비 정확한 추정 필요</li><li>변동성이 큼</li></ul><p><strong>개선: Half-Kelly 또는 Quarter-Kelly</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-python data-lang=python><span style=display:flex><span>kelly_percentage <span style=color:#f92672>=</span> (win_rate <span style=color:#f92672>-</span> (<span style=color:#ae81ff>1</span> <span style=color:#f92672>-</span> win_rate)) <span style=color:#f92672>/</span> reward_risk_ratio
</span></span><span style=display:flex><span>safe_percentage <span style=color:#f92672>=</span> kelly_percentage <span style=color:#f92672>*</span> <span style=color:#ae81ff>0.5</span>  <span style=color:#75715e># Half-Kelly</span></span></span></code></pre></div><p><strong>적용 사례</strong>: 경험 많은 트레이더, 안정적인 전략</p><h3 id=925-변동성-기반-volatility-based>9.2.5 변동성 기반 (Volatility-Based)<a class=anchor href=#925-%eb%b3%80%eb%8f%99%ec%84%b1-%ea%b8%b0%eb%b0%98-volatility-based>#</a></h3><p><strong>방법</strong>: ATR(Average True Range)를 사용한 변동성 고려</p>$$
\text{Position Size} = \frac{\text{Account Value} \times \text{Risk \%}}{\text{ATR} \times \text{ATR Multiplier}}
$$<p><strong>예시</strong>:</p><pre tabindex=0><code>계좌: $10,000
위험 허용: 1% → $100
ATR(14) = $5
ATR 배수 = 2 (손절매 = 진입가 - 2×ATR)

포지션 크기 = $100 / ($5 × 2) = 10주</code></pre><p><strong>장점</strong>:</p><ul><li>시장 변동성 자동 반영</li><li>동적 위험 조정</li><li>다양한 자산 비교 가능</li></ul><p><strong>단점</strong>:</p><ul><li>ATR 계산 필요</li><li>구현 복잡</li></ul><p><strong>적용 사례</strong>: 다양한 자산 거래, 변동성 큰 시장</p><h2 id=93-backtrader에서-포지션-크기-관리>9.3 Backtrader에서 포지션 크기 관리<a class=anchor href=#93-backtrader%ec%97%90%ec%84%9c-%ed%8f%ac%ec%a7%80%ec%85%98-%ed%81%ac%ea%b8%b0-%ea%b4%80%eb%a6%ac>#</a></h2><h3 id=931-sizer-클래스>9.3.1 Sizer 클래스<a class=anchor href=#931-sizer-%ed%81%b4%eb%9e%98%ec%8a%a4>#</a></h3><p>Backtrader는 <code>Sizer</code> 클래스를 통해 포지션 크기를 관리합니다:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># 고정 비율</span>
</span></span><span style=display:flex><span>cerebro<span style=color:#f92672>.</span>addsizer(bt<span style=color:#f92672>.</span>sizers<span style=color:#f92672>.</span>PercentSizer, percents<span style=color:#f92672>=</span><span style=color:#ae81ff>95</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 고정 수량</span>
</span></span><span style=display:flex><span>cerebro<span style=color:#f92672>.</span>addsizer(bt<span style=color:#f92672>.</span>sizers<span style=color:#f92672>.</span>FixedSize, stake<span style=color:#f92672>=</span><span style=color:#ae81ff>100</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 고정 위험 (커스텀 구현 필요)</span>
</span></span><span style=display:flex><span>cerebro<span style=color:#f92672>.</span>addsizer(FixedRiskSizer, risk_percent<span style=color:#f92672>=</span><span style=color:#ae81ff>1.0</span>)</span></span></code></pre></div><h3 id=932-커스텀-sizer-구현>9.3.2 커스텀 Sizer 구현<a class=anchor href=#932-%ec%bb%a4%ec%8a%a4%ed%85%80-sizer-%ea%b5%ac%ed%98%84>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>FixedRiskSizer</span>(bt<span style=color:#f92672>.</span>Sizer):
</span></span><span style=display:flex><span>    params <span style=color:#f92672>=</span> (
</span></span><span style=display:flex><span>        (<span style=color:#e6db74>&#39;risk_percent&#39;</span>, <span style=color:#ae81ff>1.0</span>),  <span style=color:#75715e># 위험 비율 (%)</span>
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>_getsizing</span>(self, comminfo, cash, data, isbuy):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> isbuy:
</span></span><span style=display:flex><span>            <span style=color:#75715e># 계좌 크기</span>
</span></span><span style=display:flex><span>            account_value <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>broker<span style=color:#f92672>.</span>getvalue()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#75715e># 위험 금액</span>
</span></span><span style=display:flex><span>            risk_amount <span style=color:#f92672>=</span> account_value <span style=color:#f92672>*</span> (self<span style=color:#f92672>.</span>params<span style=color:#f92672>.</span>risk_percent <span style=color:#f92672>/</span> <span style=color:#ae81ff>100</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#75715e># 진입가와 손절가 (전략에서 설정)</span>
</span></span><span style=display:flex><span>            entry_price <span style=color:#f92672>=</span> data<span style=color:#f92672>.</span>close[<span style=color:#ae81ff>0</span>]
</span></span><span style=display:flex><span>            stop_loss <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>strategy<span style=color:#f92672>.</span>stop_loss_price
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#75715e># 주당 위험</span>
</span></span><span style=display:flex><span>            risk_per_share <span style=color:#f92672>=</span> entry_price <span style=color:#f92672>-</span> stop_loss
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> risk_per_share <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span>:
</span></span><span style=display:flex><span>                <span style=color:#75715e># 포지션 크기 계산</span>
</span></span><span style=display:flex><span>                position_size <span style=color:#f92672>=</span> risk_amount <span style=color:#f92672>/</span> risk_per_share
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> int(position_size)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span></span></span></code></pre></div><h2 id=94-실전-구현>9.4 실전 구현<a class=anchor href=#94-%ec%8b%a4%ec%a0%84-%ea%b5%ac%ed%98%84>#</a></h2><p>이번 챕터의 코드에서는 다음을 구현합니다:</p><ol><li><strong>고정 비율 전략</strong>: 95% 투자</li><li><strong>고정 위험 전략</strong>: 거래당 1% 위험</li><li><strong>켈리 기준 전략</strong>: Half-Kelly 방법</li><li><strong>변동성 기반 전략</strong>: ATR 기반 포지션 크기</li><li><strong>성과 비교</strong>: 각 방법의 수익률, 위험, Sharpe Ratio</li></ol><h2 id=95-기대-결과>9.5 기대 결과<a class=anchor href=#95-%ea%b8%b0%eb%8c%80-%ea%b2%b0%ea%b3%bc>#</a></h2><p>코드를 실행하면 다음을 확인할 수 있습니다:</p><ol><li><strong>계좌 성장 곡선</strong>: 각 포지션 크기 방법별 계좌 가치 변화</li><li><strong>포지션 크기 변화</strong>: 시간에 따른 포지션 크기 조정</li><li><strong>위험 지표</strong>:<ul><li>최대 낙폭 (Maximum Drawdown)</li><li>변동성 (Volatility)</li><li>Sharpe Ratio</li></ul></li><li><strong>거래 통계</strong>: 평균 포지션 크기, 최대/최소 포지션</li><li><strong>비교 분석</strong>: 어떤 방법이 가장 안정적이고 수익성이 높은가?</li></ol><h2 id=96-분석-포인트>9.6 분석 포인트<a class=anchor href=#96-%eb%b6%84%ec%84%9d-%ed%8f%ac%ec%9d%b8%ed%8a%b8>#</a></h2><p>코드를 실행한 후 다음을 분석해보세요:</p><ol><li><strong>위험 조정 수익</strong>: 높은 수익률보다 Sharpe Ratio가 중요</li><li><strong>최대 낙폭</strong>: 감내할 수 있는 수준인가?</li><li><strong>계좌 성장 안정성</strong>: 부드러운 성장 vs. 급등락</li><li><strong>포지션 크기 변화</strong>: 시장 변동성에 적절히 반응하는가?</li><li><strong>복리 효과</strong>: 고정 비율 방법의 복리 효과 확인</li></ol><h2 id=97-포지션-크기-결정-시-주의사항>9.7 포지션 크기 결정 시 주의사항<a class=anchor href=#97-%ed%8f%ac%ec%a7%80%ec%85%98-%ed%81%ac%ea%b8%b0-%ea%b2%b0%ec%a0%95-%ec%8b%9c-%ec%a3%bc%ec%9d%98%ec%82%ac%ed%95%ad>#</a></h2><h3 id=971-과도한-레버리지-피하기>9.7.1 과도한 레버리지 피하기<a class=anchor href=#971-%ea%b3%bc%eb%8f%84%ed%95%9c-%eb%a0%88%eb%b2%84%eb%a6%ac%ec%a7%80-%ed%94%bc%ed%95%98%ea%b8%b0>#</a></h3><p><strong>문제</strong>: 켈리 기준이 20%를 제안해도 너무 공격적</p><p><strong>해결책</strong>: Half-Kelly 또는 Quarter-Kelly 사용</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-python data-lang=python><span style=display:flex><span>kelly <span style=color:#f92672>=</span> <span style=color:#ae81ff>0.20</span>
</span></span><span style=display:flex><span>safe_kelly <span style=color:#f92672>=</span> kelly <span style=color:#f92672>*</span> <span style=color:#ae81ff>0.5</span>  <span style=color:#75715e># 10%</span></span></span></code></pre></div><h3 id=972-연속-손실-대비>9.7.2 연속 손실 대비<a class=anchor href=#972-%ec%97%b0%ec%86%8d-%ec%86%90%ec%8b%a4-%eb%8c%80%eb%b9%84>#</a></h3><p><strong>문제</strong>: 연속 손실 시 계좌 급감</p><p><strong>해결책</strong>: 최대 손실 제한 설정</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>if</span> consecutive_losses <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>3</span>:
</span></span><span style=display:flex><span>    position_size <span style=color:#f92672>*=</span> <span style=color:#ae81ff>0.5</span>  <span style=color:#75715e># 포지션 크기 절반으로 축소</span></span></span></code></pre></div><h3 id=973-승률과-손익비-변화>9.7.3 승률과 손익비 변화<a class=anchor href=#973-%ec%8a%b9%eb%a5%a0%ea%b3%bc-%ec%86%90%ec%9d%b5%eb%b9%84-%eb%b3%80%ed%99%94>#</a></h3><p><strong>문제</strong>: 과거 데이터 기반 켈리 계산이 미래에 맞지 않음</p><p><strong>해결책</strong>:</p><ul><li>보수적 추정 사용</li><li>주기적으로 재계산</li><li>실시간 성과 모니터링</li></ul><h3 id=974-유동성-고려>9.7.4 유동성 고려<a class=anchor href=#974-%ec%9c%a0%eb%8f%99%ec%84%b1-%ea%b3%a0%eb%a0%a4>#</a></h3><p><strong>문제</strong>: 계산된 포지션 크기가 시장 유동성 초과</p><p><strong>해결책</strong>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-python data-lang=python><span style=display:flex><span>daily_volume <span style=color:#f92672>=</span> data<span style=color:#f92672>.</span>volume[<span style=color:#ae81ff>0</span>]
</span></span><span style=display:flex><span>max_position <span style=color:#f92672>=</span> daily_volume <span style=color:#f92672>*</span> <span style=color:#ae81ff>0.01</span>  <span style=color:#75715e># 일일 거래량의 1%</span>
</span></span><span style=display:flex><span>position_size <span style=color:#f92672>=</span> min(calculated_size, max_position)</span></span></code></pre></div><h2 id=98-실전-적용-가이드>9.8 실전 적용 가이드<a class=anchor href=#98-%ec%8b%a4%ec%a0%84-%ec%a0%81%ec%9a%a9-%ea%b0%80%ec%9d%b4%eb%93%9c>#</a></h2><h3 id=981-초보자-권장-설정>9.8.1 초보자 권장 설정<a class=anchor href=#981-%ec%b4%88%eb%b3%b4%ec%9e%90-%ea%b6%8c%ec%9e%a5-%ec%84%a4%ec%a0%95>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># 보수적 접근</span>
</span></span><span style=display:flex><span>position_size <span style=color:#f92672>=</span> account_value <span style=color:#f92672>*</span> <span style=color:#ae81ff>0.50</span>  <span style=color:#75715e># 50% 투자</span>
</span></span><span style=display:flex><span>risk_per_trade <span style=color:#f92672>=</span> account_value <span style=color:#f92672>*</span> <span style=color:#ae81ff>0.01</span>  <span style=color:#75715e># 1% 위험</span></span></span></code></pre></div><h3 id=982-중급자-권장-설정>9.8.2 중급자 권장 설정<a class=anchor href=#982-%ec%a4%91%ea%b8%89%ec%9e%90-%ea%b6%8c%ec%9e%a5-%ec%84%a4%ec%a0%95>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># 균형 잡힌 접근</span>
</span></span><span style=display:flex><span>position_size <span style=color:#f92672>=</span> account_value <span style=color:#f92672>*</span> <span style=color:#ae81ff>0.80</span>  <span style=color:#75715e># 80% 투자</span>
</span></span><span style=display:flex><span>risk_per_trade <span style=color:#f92672>=</span> account_value <span style=color:#f92672>*</span> <span style=color:#ae81ff>0.015</span>  <span style=color:#75715e># 1.5% 위험</span></span></span></code></pre></div><h3 id=983-전문가-권장-설정>9.8.3 전문가 권장 설정<a class=anchor href=#983-%ec%a0%84%eb%ac%b8%ea%b0%80-%ea%b6%8c%ec%9e%a5-%ec%84%a4%ec%a0%95>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># 공격적 접근 (Half-Kelly)</span>
</span></span><span style=display:flex><span>kelly <span style=color:#f92672>=</span> (win_rate <span style=color:#f92672>-</span> (<span style=color:#ae81ff>1</span> <span style=color:#f92672>-</span> win_rate)) <span style=color:#f92672>/</span> reward_risk_ratio
</span></span><span style=display:flex><span>position_size <span style=color:#f92672>=</span> account_value <span style=color:#f92672>*</span> kelly <span style=color:#f92672>*</span> <span style=color:#ae81ff>0.5</span>
</span></span><span style=display:flex><span>risk_per_trade <span style=color:#f92672>=</span> account_value <span style=color:#f92672>*</span> <span style=color:#ae81ff>0.02</span>  <span style=color:#75715e># 2% 위험</span></span></span></code></pre></div><h2 id=99-포지션-크기-최적화>9.9 포지션 크기 최적화<a class=anchor href=#99-%ed%8f%ac%ec%a7%80%ec%85%98-%ed%81%ac%ea%b8%b0-%ec%b5%9c%ec%a0%81%ed%99%94>#</a></h2><h3 id=991-백테스팅을-통한-최적화>9.9.1 백테스팅을 통한 최적화<a class=anchor href=#991-%eb%b0%b1%ed%85%8c%ec%8a%a4%ed%8c%85%ec%9d%84-%ed%86%b5%ed%95%9c-%ec%b5%9c%ec%a0%81%ed%99%94>#</a></h3><p>다양한 포지션 크기로 백테스트:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>for</span> position_percent <span style=color:#f92672>in</span> [<span style=color:#ae81ff>0.25</span>, <span style=color:#ae81ff>0.50</span>, <span style=color:#ae81ff>0.75</span>, <span style=color:#ae81ff>0.95</span>]:
</span></span><span style=display:flex><span>    <span style=color:#75715e># 백테스트 실행</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Sharpe Ratio 및 Max Drawdown 비교</span></span></span></code></pre></div><p><strong>최적화 목표</strong>:</p><ul><li>최대 Sharpe Ratio</li><li>최소 Drawdown</li><li>목표 수익률 달성</li></ul><h3 id=992-동적-포지션-조정>9.9.2 동적 포지션 조정<a class=anchor href=#992-%eb%8f%99%ec%a0%81-%ed%8f%ac%ec%a7%80%ec%85%98-%ec%a1%b0%ec%a0%95>#</a></h3><p>시장 환경에 따라 포지션 크기 조정:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>if</span> market_volatility <span style=color:#f92672>&gt;</span> threshold:
</span></span><span style=display:flex><span>    position_size <span style=color:#f92672>*=</span> <span style=color:#ae81ff>0.7</span>  <span style=color:#75715e># 변동성 높을 때 축소</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>    position_size <span style=color:#f92672>*=</span> <span style=color:#ae81ff>1.0</span>  <span style=color:#75715e># 정상</span></span></span></code></pre></div><h2 id=910-실행-결과>9.10 실행 결과<a class=anchor href=#910-%ec%8b%a4%ed%96%89-%ea%b2%b0%ea%b3%bc>#</a></h2><p>실제로 스크립트를 실행한 결과입니다:</p><pre tabindex=0><code>============================================================
Chapter 9: 포지션 크기 결정
============================================================

=== 백테스트 설정 ===
- 티커: AAPL
- 기간: 2019-01-01 ~ 2024-01-01
- 초기 자금: $10,000.00
- 전략: SMA(50/200) 크로스오버

============================================================
백테스트 실행 중...
============================================================

[1/4] 고정 비율 (95%) 전략...

============================================================
=== 고정 비율 (95%) ===
============================================================

총 수익률: +11.07%
최종 자금: $11,106.95
Sharpe Ratio: 0.266
Max Drawdown: 14.41%
거래 횟수: 2, 승률: 0.0%

[2/4] 고정 비율 (50%) 전략...

============================================================
=== 고정 비율 (50%) ===
============================================================

총 수익률: +6.24%
최종 자금: $10,623.54
Sharpe Ratio: 0.266
Max Drawdown: 8.31%
거래 횟수: 2, 승률: 0.0%

[3/4] 고정 위험 (1%) 전략...

============================================================
=== 고정 위험 (1%) ===
============================================================

총 수익률: +3.04%
최종 자금: $10,303.77
Sharpe Ratio: 0.311
Max Drawdown: 3.64%
거래 횟수: 2, 승률: 0.0%

[4/4] 켈리 기준 (Half-Kelly) 전략...

============================================================
=== 켈리 기준 (Half-Kelly) ===
============================================================

총 수익률: +0.43%
최종 자금: $10,042.92
Sharpe Ratio: 0.277
Max Drawdown: 0.58%
거래 횟수: 2, 승률: 0.0%

============================================================
=== 포지션 크기 방법 비교 요약 ===
============================================================

방법                            수익률     Sharpe        MDD
------------------------------------------------------------
고정 비율 (95%)                11.07%      0.27     14.41%
고정 비율 (50%)                 6.24%      0.27      8.31%
고정 위험 (1%)                  3.04%      0.31      3.64%
Kelly (Half)                0.43%      0.28      0.58%</code></pre><p><img src=/images/chapter09/position_sizing.png alt="포지션 크기 결정"></p><h3 id=차트-해석>차트 해석<a class=anchor href=#%ec%b0%a8%ed%8a%b8-%ed%95%b4%ec%84%9d>#</a></h3><p><strong>패널 1: 계좌 가치 변화</strong></p><ul><li>4가지 포지션 크기 방법의 계좌 가치 추이 비교</li><li><strong>고정 비율 95%</strong> (파란색): 가장 높은 수익률 (+11.07%)이지만 가장 큰 변동성</li><li><strong>고정 비율 50%</strong> (주황색): 중간 수익률 (+6.24%), 변동성 절반 감소</li><li><strong>고정 위험 1%</strong> (녹색): 보수적 수익률 (+3.04%), 매우 안정적</li><li><strong>Kelly Half</strong> (빨간색): 가장 낮은 수익률 (+0.43%), 최소 변동성</li></ul><p><strong>패널 2: Drawdown 비교</strong></p><ul><li>각 방법의 최대 낙폭 시각화</li><li><strong>고정 비율 95%</strong>: 최대 14.41% 하락 - 심리적으로 부담될 수 있는 수준</li><li><strong>고정 비율 50%</strong>: 8.31% 하락 - 절반 투자로 손실도 절반</li><li><strong>고정 위험 1%</strong>: 3.64% 하락 - 안정적이지만 기회비용 큼</li><li><strong>Kelly Half</strong>: 0.58% 하락 - 거의 손실 없지만 수익도 미미</li></ul><p><strong>패널 3: 포지션 크기 변화</strong></p><ul><li>시간에 따른 포지션 크기 (주식 수) 변화</li><li>고정 비율 방법은 계좌 가치에 비례하여 포지션 조정 (복리 효과)</li><li>고정 위험/Kelly 방법은 시장 변동성에 따라 동적 조정</li><li>변동성 높을 때 포지션 자동 축소 = 위험 관리</li></ul><p><strong>패널 4: 위험-수익 산점도</strong></p><ul><li>X축: Maximum Drawdown (위험)</li><li>Y축: 총 수익률 (수익)</li><li><strong>이상적 위치</strong>: 왼쪽 상단 (낮은 위험, 높은 수익)</li><li><strong>관찰</strong>: 고정 비율 95%가 가장 높은 수익이지만 위험도 가장 높음</li><li><strong>트레이드오프</strong>: 더 높은 수익을 원하면 더 큰 위험 감수 필요</li></ul><h3 id=성과-분석-및-핵심-인사이트>성과 분석 및 핵심 인사이트<a class=anchor href=#%ec%84%b1%ea%b3%bc-%eb%b6%84%ec%84%9d-%eb%b0%8f-%ed%95%b5%ec%8b%ac-%ec%9d%b8%ec%82%ac%ec%9d%b4%ed%8a%b8>#</a></h3><h4 id=1-포지션-크기와-수익률의-관계>1. 포지션 크기와 수익률의 관계<a class=anchor href=#1-%ed%8f%ac%ec%a7%80%ec%85%98-%ed%81%ac%ea%b8%b0%ec%99%80-%ec%88%98%ec%9d%b5%eb%a5%a0%ec%9d%98-%ea%b4%80%ea%b3%84>#</a></h4><p><strong>결과 요약</strong>:</p><table><thead><tr><th>방법</th><th>수익률</th><th>Sharpe Ratio</th><th>Max DD</th><th>최종 자금</th></tr></thead><tbody><tr><td>고정 비율 95%</td><td>+11.07%</td><td>0.266</td><td>14.41%</td><td>$11,106.95</td></tr><tr><td>고정 비율 50%</td><td>+6.24%</td><td>0.266</td><td>8.31%</td><td>$10,623.54</td></tr><tr><td>고정 위험 1%</td><td>+3.04%</td><td>0.311</td><td>3.64%</td><td>$10,303.77</td></tr><tr><td>Kelly Half</td><td>+0.43%</td><td>0.277</td><td>0.58%</td><td>$10,042.92</td></tr></tbody></table><p><strong>관찰</strong>:</p><ul><li>포지션 크기가 클수록 수익률과 위험 모두 증가</li><li>고정 비율 50%는 95%의 56% 수익 (정확히 절반은 아님)</li><li>수익률은 선형적이지 않고 복리 효과와 변동성에 영향받음</li></ul><h4 id=2-리스크-조정-수익률-sharpe-ratio>2. 리스크 조정 수익률 (Sharpe Ratio)<a class=anchor href=#2-%eb%a6%ac%ec%8a%a4%ed%81%ac-%ec%a1%b0%ec%a0%95-%ec%88%98%ec%9d%b5%eb%a5%a0-sharpe-ratio>#</a></h4><p><strong>고정 위험 1%가 최고 Sharpe Ratio (0.311)</strong>:</p><ul><li>변동성 대비 가장 효율적인 수익</li><li>절대 수익률은 낮지만 위험을 고려하면 가장 우수</li><li>실전에서는 Sharpe Ratio가 더 중요한 지표</li></ul><p><strong>Sharpe Ratio 해석</strong>:</p><ul><li>0.27-0.31: 모두 보통 수준 (1.0 이상이 우수)</li><li>전략 자체 (SMA 크로스오버)의 성과가 제한적</li><li>좋은 전략 + 적절한 포지션 크기 = 높은 Sharpe</li></ul><h4 id=3-maximum-drawdown의-중요성>3. Maximum Drawdown의 중요성<a class=anchor href=#3-maximum-drawdown%ec%9d%98-%ec%a4%91%ec%9a%94%ec%84%b1>#</a></h4><p><strong>감내할 수 있는 수준인가?</strong>:</p><ul><li><strong>14.41%</strong> (95%): 많은 투자자에게 심리적 부담</li><li><strong>8.31%</strong> (50%): 대부분 감내 가능</li><li><strong>3.64%</strong> (1%): 매우 안정적, 초보자 적합</li><li><strong>0.58%</strong> (Kelly): 거의 없음, 하지만 수익도 미미</li></ul><p><strong>실전 적용</strong>:</p><ul><li>자신의 손실 허용도를 먼저 파악</li><li>&ldquo;얼마 잃으면 잠을 못 자는가?&rdquo; 질문</li><li>Max DD &lt; 20%를 일반적 목표로 설정</li></ul><h4 id=4-켈리-기준의-실전-적용>4. 켈리 기준의 실전 적용<a class=anchor href=#4-%ec%bc%88%eb%a6%ac-%ea%b8%b0%ec%a4%80%ec%9d%98-%ec%8b%a4%ec%a0%84-%ec%a0%81%ec%9a%a9>#</a></h4><p><strong>Kelly가 가장 낮은 수익률을 보인 이유</strong>:</p><ul><li>전략의 승률이 낮아 (2회 거래, 승률 0%) Kelly 값이 매우 보수적으로 계산됨</li><li>Half-Kelly는 Full Kelly의 절반으로 더욱 보수적</li><li><strong>교훈</strong>: 과거 성과가 불확실하면 Kelly는 극도로 조심스러워짐</li></ul><p><strong>Kelly의 장단점</strong>:</p><ul><li><strong>장점</strong>: 이론적으로 최적의 장기 복리 성장</li><li><strong>단점</strong>: 승률/손익비 추정이 정확해야 함, 실전에서는 과거 데이터 사용</li><li><strong>권장</strong>: 항상 Half-Kelly 또는 Quarter-Kelly 사용</li></ul><h4 id=5-복리-효과-관찰>5. 복리 효과 관찰<a class=anchor href=#5-%eb%b3%b5%eb%a6%ac-%ed%9a%a8%ea%b3%bc-%ea%b4%80%ec%b0%b0>#</a></h4><p><strong>고정 비율 방법의 복리</strong>:</p><ul><li>수익 발생 시 다음 거래의 포지션 크기 증가</li><li>손실 발생 시 다음 거래의 포지션 크기 감소</li><li>장기적으로 계좌 성장 가속화</li></ul><p><strong>복리의 양면성</strong>:</p><ul><li>✅ 수익 시 더 빠른 성장</li><li>❌ 손실 시 더 빠른 감소</li><li>연속 손실이 치명적일 수 있음</li></ul><h4 id=6-포지션-크기-선택-가이드>6. 포지션 크기 선택 가이드<a class=anchor href=#6-%ed%8f%ac%ec%a7%80%ec%85%98-%ed%81%ac%ea%b8%b0-%ec%84%a0%ed%83%9d-%ea%b0%80%ec%9d%b4%eb%93%9c>#</a></h4><p><strong>목표에 따른 선택</strong>:</p><ul><li><p><strong>공격적 성장 추구</strong>: 고정 비율 80-95%</p><ul><li>높은 수익 기대</li><li>변동성 감내 필요</li><li>충분한 경험과 자금 필요</li></ul></li><li><p><strong>균형 잡힌 접근</strong>: 고정 비율 50-70%</p><ul><li>적절한 수익과 위험 균형</li><li>대부분의 투자자에게 적합</li><li>권장 시작점</li></ul></li><li><p><strong>보수적 운용</strong>: 고정 위험 1%</p><ul><li>안정적 계좌 성장</li><li>초보자, 큰 자금 적합</li><li>심리적 안정감</li></ul></li><li><p><strong>초보수적</strong>: Kelly (Half/Quarter)</p><ul><li>최소 위험</li><li>전략 검증 단계</li><li>실전 경험 부족 시</li></ul></li></ul><h4 id=7-실전-적용-시-고려사항>7. 실전 적용 시 고려사항<a class=anchor href=#7-%ec%8b%a4%ec%a0%84-%ec%a0%81%ec%9a%a9-%ec%8b%9c-%ea%b3%a0%eb%a0%a4%ec%82%ac%ed%95%ad>#</a></h4><p><strong>포지션 크기 결정 체크리스트</strong>:</p><ul><li><input disabled type=checkbox> 계좌 크기: 작은 계좌는 더 보수적으로</li><li><input disabled type=checkbox> 경험 수준: 초보자는 50% 이하</li><li><input disabled type=checkbox> 위험 허용도: 손실 견딜 수 있는 범위 확인</li><li><input disabled type=checkbox> 전략 신뢰도: 검증된 전략은 더 공격적으로</li><li><input disabled type=checkbox> 시장 환경: 불확실할 때는 축소</li><li><input disabled type=checkbox> 다각화: 다른 전략/자산에도 분산 필요</li></ul><p><strong>동적 조정 전략</strong>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># 예시: 연속 손실 시 포지션 축소</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> consecutive_losses <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>3</span>:
</span></span><span style=display:flex><span>    position_percent <span style=color:#f92672>*=</span> <span style=color:#ae81ff>0.5</span>  <span style=color:#75715e># 절반으로 축소</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>elif</span> consecutive_wins <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>5</span>:
</span></span><span style=display:flex><span>    position_percent <span style=color:#f92672>=</span> min(original_percent, position_percent <span style=color:#f92672>*</span> <span style=color:#ae81ff>1.2</span>)  <span style=color:#75715e># 점진적 증가</span></span></span></code></pre></div><h4 id=8-이-테스트의-한계>8. 이 테스트의 한계<a class=anchor href=#8-%ec%9d%b4-%ed%85%8c%ec%8a%a4%ed%8a%b8%ec%9d%98-%ed%95%9c%ea%b3%84>#</a></h4><p><strong>주의사항</strong>:</p><ul><li>SMA 크로스오버는 2회만 거래 (샘플 적음)</li><li>더 많은 거래가 있는 전략에서는 결과가 다를 수 있음</li><li>단일 종목 (AAPL)에만 테스트</li><li>2019-2024 특정 기간에 최적화됨</li></ul><p><strong>권장사항</strong>:</p><ul><li>여러 종목, 여러 기간에서 테스트</li><li>최소 30회 이상 거래가 있는 전략으로 검증</li><li>실전 투입 전 충분한 샘플 외 검증</li></ul><h4 id=9-최종-권장사항>9. 최종 권장사항<a class=anchor href=#9-%ec%b5%9c%ec%a2%85-%ea%b6%8c%ec%9e%a5%ec%82%ac%ed%95%ad>#</a></h4><p><strong>초보자</strong>: 고정 비율 50% + 거래당 위험 1%</p><ul><li>균형 잡힌 접근</li><li>충분한 경험 쌓기</li><li>Max DD 10% 이하 목표</li></ul><p><strong>중급자</strong>: 고정 비율 70-80% + 거래당 위험 1.5%</p><ul><li>검증된 전략 운용</li><li>Max DD 15% 이하 목표</li><li>시장 환경에 따라 동적 조정</li></ul><p><strong>전문가</strong>: 고정 비율 + Kelly 결합</p><ul><li>전략별 최적 포지션 계산</li><li>복수 전략 포트폴리오 운용</li><li>실시간 리스크 모니터링</li></ul><h2 id=911-개선-방향>9.11 개선 방향<a class=anchor href=#911-%ea%b0%9c%ec%84%a0-%eb%b0%a9%ed%96%a5>#</a></h2><p>포지션 크기 전략을 더욱 개선하는 방법:</p><ol><li><strong>다중 자산 포트폴리오</strong>: 자산별 최적 포지션 배분</li><li><strong>상관관계 고려</strong>: 상관관계 높은 자산은 합산 위험 계산</li><li><strong>시장 체제 인식</strong>: 상승장/하락장/횡보장별 다른 설정</li><li><strong>머신러닝 통합</strong>: 최적 포지션 크기 학습</li><li><strong>실시간 조정</strong>: 실시간 변동성 및 위험에 따라 동적 조정</li></ol><h2 id=다음-단계>다음 단계<a class=anchor href=#%eb%8b%a4%ec%9d%8c-%eb%8b%a8%ea%b3%84>#</a></h2><p>다음 챕터에서는 손절매(Stop Loss)와 익절매(Take Profit)를 포함한 종합적인 리스크 관리 기법을 배웁니다. 포지션 크기 결정만큼이나 중요한 것이 언제 손실을 확정하고 이익을 실현할 것인가입니다.</p><hr><p><strong>코드 실행:</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>cd codes
</span></span><span style=display:flex><span>uv run chapter09/01_position_sizing.py</span></span></code></pre></div></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div></div><div></div></div><div class="flex flex-wrap justify-between"><span><a href=/intro-to-backtesting/docs/chapter08/ class="flex align-center"><img src=/intro-to-backtesting/icons/backward.svg class=book-icon alt=Backward>
<span>Chapter 8: 다중 지표 결합 전략</span>
</a></span><span><a href=/intro-to-backtesting/docs/chapter10/ class="flex align-center"><span>Chapter 10: 리스크 관리와 손절매</span>
<img src=/intro-to-backtesting/icons/forward.svg class=book-icon alt=Forward></a></span></div><script>(function(){document.querySelectorAll("pre:has(code)").forEach(e=>{e.addEventListener("click",e.focus),e.addEventListener("copy",function(t){if(t.preventDefault(),navigator.clipboard){const t=window.getSelection().toString()||e.textContent;navigator.clipboard.writeText(t)}})})})()</script></footer><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#91-포지션-크기의-중요성>9.1 포지션 크기의 중요성</a><ul><li><a href=#911-포지션-크기가-중요한-이유>9.1.1 포지션 크기가 중요한 이유</a></li><li><a href=#912-포지션-크기의-기본-원칙>9.1.2 포지션 크기의 기본 원칙</a></li></ul></li><li><a href=#92-포지션-크기-결정-방법>9.2 포지션 크기 결정 방법</a><ul><li><a href=#921-고정-금액-fixed-amount>9.2.1 고정 금액 (Fixed Amount)</a></li><li><a href=#922-고정-비율-fixed-percentage>9.2.2 고정 비율 (Fixed Percentage)</a></li><li><a href=#923-고정-위험-fixed-risk>9.2.3 고정 위험 (Fixed Risk)</a></li><li><a href=#924-켈리-기준-kelly-criterion>9.2.4 켈리 기준 (Kelly Criterion)</a></li><li><a href=#925-변동성-기반-volatility-based>9.2.5 변동성 기반 (Volatility-Based)</a></li></ul></li><li><a href=#93-backtrader에서-포지션-크기-관리>9.3 Backtrader에서 포지션 크기 관리</a><ul><li><a href=#931-sizer-클래스>9.3.1 Sizer 클래스</a></li><li><a href=#932-커스텀-sizer-구현>9.3.2 커스텀 Sizer 구현</a></li></ul></li><li><a href=#94-실전-구현>9.4 실전 구현</a></li><li><a href=#95-기대-결과>9.5 기대 결과</a></li><li><a href=#96-분석-포인트>9.6 분석 포인트</a></li><li><a href=#97-포지션-크기-결정-시-주의사항>9.7 포지션 크기 결정 시 주의사항</a><ul><li><a href=#971-과도한-레버리지-피하기>9.7.1 과도한 레버리지 피하기</a></li><li><a href=#972-연속-손실-대비>9.7.2 연속 손실 대비</a></li><li><a href=#973-승률과-손익비-변화>9.7.3 승률과 손익비 변화</a></li><li><a href=#974-유동성-고려>9.7.4 유동성 고려</a></li></ul></li><li><a href=#98-실전-적용-가이드>9.8 실전 적용 가이드</a><ul><li><a href=#981-초보자-권장-설정>9.8.1 초보자 권장 설정</a></li><li><a href=#982-중급자-권장-설정>9.8.2 중급자 권장 설정</a></li><li><a href=#983-전문가-권장-설정>9.8.3 전문가 권장 설정</a></li></ul></li><li><a href=#99-포지션-크기-최적화>9.9 포지션 크기 최적화</a><ul><li><a href=#991-백테스팅을-통한-최적화>9.9.1 백테스팅을 통한 최적화</a></li><li><a href=#992-동적-포지션-조정>9.9.2 동적 포지션 조정</a></li></ul></li><li><a href=#910-실행-결과>9.10 실행 결과</a><ul><li><a href=#차트-해석>차트 해석</a></li><li><a href=#성과-분석-및-핵심-인사이트>성과 분석 및 핵심 인사이트</a></li></ul></li><li><a href=#911-개선-방향>9.11 개선 방향</a></li><li><a href=#다음-단계>다음 단계</a></li></ul></nav></div></aside></main></body></html>